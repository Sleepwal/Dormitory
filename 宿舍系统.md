# 1. 创建Vue项目
## 1.1 使用Vue UI
命令行运行vue ui, 创建项目
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665238606218-9a6c85a7-826c-4478-a310-6177c5c08c10.png#averageHue=%23110f0f&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=108&id=u2d15b751&margin=%5Bobject%20Object%5D&name=image.png&originHeight=135&originWidth=513&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7382&status=error&style=none&taskId=u1ff1693e-e759-4c13-b7f9-f66bc443990&title=&width=410.4)
选择项目的目录
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665238783297-a60cbe68-592e-4ff2-9497-ae16477ae28c.png#averageHue=%23cad9b4&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=209&id=u466a0d0b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=261&originWidth=1595&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24106&status=error&style=none&taskId=u3d3ac524-67d7-4728-85e7-f9626d73136&title=&width=1276)
文件夹命名
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665238914630-a732e9a6-2ef5-4c25-9054-a0367d735161.png#averageHue=%23fefefe&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=724&id=u05b36588&margin=%5Bobject%20Object%5D&name=image.png&originHeight=905&originWidth=635&originalType=binary&ratio=1&rotation=0&showTitle=false&size=41801&status=error&style=none&taskId=ue472a220-d3c8-4ccb-9457-b60324bc736&title=&width=508)
手动配置
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665238955070-979cecbe-f087-49a9-ac9d-1158a1c8de9c.png#averageHue=%23e4d1b1&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=708&id=u1241070d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=885&originWidth=1556&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57240&status=error&style=none&taskId=u0cea21e9-f0a5-4d50-a22d-63b1cf1c20f&title=&width=1244.8)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665239041174-fc3134c7-5c92-448c-8e38-097568fc99be.png#averageHue=%23e7dfba&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=700&id=u4c00c5a3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=875&originWidth=1554&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110947&status=error&style=none&taskId=ub043efa6-6eed-408c-8a02-1aa1d514f13&title=&width=1243.2)
打开Router和Vuex
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665239048393-3b595423-6787-4ac9-8ee1-a27740608330.png#averageHue=%23f1f9f6&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=162&id=u630426c0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=203&originWidth=1495&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20645&status=error&style=none&taskId=u5d4762ca-e27e-490d-9e56-6bb3f8899f9&title=&width=1196)
关闭Linter
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665239054581-9890cd81-fb30-4ebf-940b-7802c7e7639f.png#averageHue=%23f4faf8&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=90&id=udff20dbd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=113&originWidth=1527&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12918&status=error&style=none&taskId=ubefc8552-0232-4127-a531-bd0c331f0d7&title=&width=1221.6)
选择2.x, 打开历史模块
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665239130320-321731d6-07d0-4512-abff-899d1014e527.png#averageHue=%23e8c38a&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=263&id=u71bc636e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=329&originWidth=1488&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43777&status=error&style=none&taskId=u30ae7faf-be7b-4b9c-8324-2056cfe6b55&title=&width=1190.4)

到插件点击添加插件
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665239497633-4ed0ff79-6e3c-484c-ba4d-f798f0615581.png#averageHue=%23dbf1e9&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=446&id=uf2d7a2e8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=558&originWidth=1890&originalType=binary&ratio=1&rotation=0&showTitle=false&size=81326&status=error&style=none&taskId=u2ee3af1d-e65f-43fb-8cd6-7196a21dae1&title=&width=1512)
安装element插件
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665239558191-acb6087c-d87a-41ff-940a-4dad5a751021.png#averageHue=%23ead7b3&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=711&id=u5e63df5d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=889&originWidth=1625&originalType=binary&ratio=1&rotation=0&showTitle=false&size=134583&status=error&style=none&taskId=u253a3470-3fd1-4d01-91f0-423123e703d&title=&width=1300)
安装axios插件
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665239746683-4ab4dafe-3372-466f-bc61-a8a07603d900.png#averageHue=%23fefefe&clientId=u3d32c991-179e-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=642&id=uf8e89b02&margin=%5Bobject%20Object%5D&name=image.png&originHeight=803&originWidth=1541&originalType=binary&ratio=1&rotation=0&showTitle=false&size=124653&status=error&style=none&taskId=u25c04a72-63a8-45ae-94aa-9da60899643&title=&width=1232.8)
# 2. 登录&注册模块
## 2.1 登录前端页面
```vue
<template>
  <div>
    <div id="blank"></div>
    <fieldset>
      <legend>用户登录</legend>
      <el-form
        :model="userForm"
        :rules="rules"
        ref="userForm"
        label-width="100px"
        class="demo-userForm"
        text-align:
        center
        style="width: 500px; margin: 0px auto"
      >
        <el-form-item label="用户名" prop="username">
          <el-input v-model="userForm.username"
            type="text"
          ></el-input>
        </el-form-item>

        <el-form-item label="密码" prop="password">
          <el-input
            type="password"
            placeholder="请输入密码"
            v-model="userForm.password"
          ></el-input>
        </el-form-item>

        <el-form-item label="确认密码" prop="checkPass">
          <el-input
            type="password"
            placeholder="请输入确认密码"
            v-model="userForm.checkPass"
            autocomplete="off"
            show-password
          ></el-input>
        </el-form-item>

        <el-form-item label="用户类型" prop="userType">
          <el-radio-group v-model="userForm.userType">
            <el-radio label="dormitoryAdmin">宿管</el-radio>
            <el-radio label="systemAdmin">系统管理员</el-radio>
          </el-radio-group>
        </el-form-item>

        <el-form-item>
          <el-button type="primary" @click="submitForm('userForm')" 
          :loading="logining"
            >登录</el-button
          >
          <el-button @click="resetForm('userForm')">重置</el-button>
        </el-form-item>
      </el-form>
    </fieldset>
  </div>
</template>

<script>
export default {
  name: "Login",
  data() {
    var validatePass = (rule, value, callback) => {
      const check = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/;
      if (value === "") {
        callback(new Error("请输入密码"));
      } else {
        if (!check.test(value)) {
          callback(new Error("密码至少包含 数字和英文，长度8-16"));
        }
        callback();
      }
    };
    var validatePass2 = (rule, value, callback) => {
      if (value === "") {
        callback(new Error("请再次输入密码"));
      } else if (value !== this.userForm.password) {
        callback(new Error("两次输入密码不一致!"));
      } else {
        callback();
      }
    };
    return {
      logining: false,
      
      userForm: {
        username: "",
        password: "",
        checkPass: "",
        userType: "",
      },
      rules: {
        username: [
          { required: true, message: "请输入用户名", trigger: "blur" },
          {
            min: 3,
            max: 20,
            message: "长度在 3 到 20 个字符",
            trigger: "blur",
          },
        ],
        password: [
          { validator: validatePass, trigger: "blur" },
        ],
        checkPass: [
          { validator: validatePass2, trigger: "blur" },
        ],

        userType: [
          { required: true, message: "请选择用户类型", trigger: "change" },
        ],
      },
    };
  },
  methods: {
    submitForm(formName) {
      this.$refs[formName].validate((valid) => {
        if (valid) {
          this.logining = true;
      
        } else {
          alert("error submit!!");
          return false;
        }
      });
    },
    resetForm(formName) {
      this.$refs[formName].resetFields();
    },
  },
};
</script>

<style scoped>
fieldset {
  /* 表单页面居中，宽度50% ,legend颜色设置，legend圆角*/
  border: 2px solid #dcdfe6;
  text-align: center;
  border-radius: 8px;
  margin: 0 auto;
  width: 50%;
  padding-top: 50px;
}

#blank {
  height: 100px;
}
</style>

```
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665284248363-891ed281-8b96-406a-bbaf-d1ae55f6894c.png#averageHue=%23fefefe&clientId=u7d81d083-faec-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=452&id=u0488defd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=565&originWidth=1177&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19893&status=error&style=none&taskId=u990fcb69-6f2a-4eb9-8263-21028fd643e&title=&width=941.6)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665285728562-b200c11e-42fd-4d89-8888-f4d11b3083d7.png#averageHue=%23fefefe&clientId=u7d81d083-faec-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=438&id=u96a7879a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=547&originWidth=1080&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20326&status=error&style=none&taskId=u760f6251-2783-4aa4-9ac1-8e678b30379&title=&width=864)

## 2.2 宿管登录后端接口
创建SpringBoot项目
添加Lombok
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665287705363-15277730-bd3f-4ae2-950a-5c93380cb6d2.png#averageHue=%232d3c43&clientId=u7d81d083-faec-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=619&id=u94cc6701&margin=%5Bobject%20Object%5D&name=image.png&originHeight=774&originWidth=1479&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63214&status=error&style=none&taskId=u9e6cc496-bb04-4519-9208-ec1a9222326&title=&width=1183.2)
添加Spring Web
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665287737150-0cbdd13d-f87f-47ea-a6a1-596821a542ee.png#averageHue=%232e3d44&clientId=u7d81d083-faec-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=586&id=u14fad83d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=733&originWidth=1448&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75267&status=error&style=none&taskId=u51dc9d7c-18ad-450c-a993-e1fc279ea40&title=&width=1158.4)
添加MySQL Driver
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665287833112-d77c9f6d-9b3f-4c2b-9af5-8df5825830cd.png#averageHue=%232e3d45&clientId=u7d81d083-faec-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=577&id=u897454fb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=721&originWidth=1420&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66946&status=error&style=none&taskId=u1b61be1a-6145-46f6-8511-4860b175630&title=&width=1136)
### ① 添加mybatis-plus依赖
```xml
<!-- mybatis-plus -->
<dependency>
  <groupId>com.baomidou</groupId>
  <artifactId>mybatis-plus-boot-starter</artifactId>
  <version>3.3.2</version>
</dependency>
<dependency>
  <groupId>com.baomidou</groupId>
  <artifactId>mybatis-plus-generator</artifactId>
  <version>3.3.2</version>
</dependency>
<dependency>
  <groupId>org.apache.velocity</groupId>
  <artifactId>velocity</artifactId>
  <version>1.7</version>
</dependency>
```
### ② mybatis-plus generator生成代码
```java
package com.sleepwalker;

import com.baomidou.mybatisplus.annotation.DbType;
import com.baomidou.mybatisplus.generator.AutoGenerator;
import com.baomidou.mybatisplus.generator.config.DataSourceConfig;
import com.baomidou.mybatisplus.generator.config.GlobalConfig;
import com.baomidou.mybatisplus.generator.config.PackageConfig;
import com.baomidou.mybatisplus.generator.config.StrategyConfig;
import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;
import org.springframework.context.ApplicationContext;
import org.springframework.web.client.HttpClientErrorException;

/**
* @package: com.sleepwalker
* @className: Main
* @author: SleepWalker
* @description: mybatis-plus generator
* @date: 12:07
* @version: 1.0
*/
public class Main {
    public static void main(String[] args) {
        //创建对象
        AutoGenerator autoGenerator = new AutoGenerator();

        //数据源
        DataSourceConfig dataSourceConfig = new DataSourceConfig();
        dataSourceConfig.setDbType(DbType.MYSQL);
        dataSourceConfig.setDriverName("com.mysql.cj.jdbc.Driver");
        dataSourceConfig.setUrl("jdbc:mysql://localhost:3306/dormitory");
        dataSourceConfig.setUsername("root");
        dataSourceConfig.setPassword("166");
        autoGenerator.setDataSource(dataSourceConfig);

        //全局配置
        GlobalConfig globalConfig = new GlobalConfig();
        //System.getProperty("user.dir") 根目录
        globalConfig.setOutputDir("D:\\Programme1\\Java_Code\\Project\\Dormitory\\SpringBootProject\\dormitoryms" + "/src/main/java");
        globalConfig.setAuthor("SleepWalker");
        globalConfig.setOpen(false); //是否把文件夹打开
        //去掉Service的I
        globalConfig.setServiceName("%sService"); //%s是类名
        autoGenerator.setGlobalConfig(globalConfig);

        //包配置
        PackageConfig packageConfig = new PackageConfig();
        //设置包名
        packageConfig.setParent("com.sleepwalker");
        packageConfig.setEntity("entity");
        packageConfig.setMapper("mapper");
        packageConfig.setService("service");
        packageConfig.setServiceImpl("service.impl");
        packageConfig.setController("controller");
        autoGenerator.setPackageInfo(packageConfig);

        //策略配置
        StrategyConfig strategyConfig = new StrategyConfig();
        //数据库名
        strategyConfig.setInclude("absent", "building", "dormitory", "dormitory_admin",
                                  "moveout", "student", "system_admin");
        //下划线转驼峰
        strategyConfig.setNaming(NamingStrategy.underline_to_camel);
        strategyConfig.setColumnNaming(NamingStrategy.underline_to_camel);
        //添加Lombok
        strategyConfig.setEntityLombokModel(true);
        autoGenerator.setStrategy(strategyConfig);

        //启动
        autoGenerator.execute();
    }
}
```
### ③ 控制器
状态码和数据用一个类存储
@Data ： 注在类上，提供类的get、set、equals、hashCode、canEqual、toString方法
```java
package com.sleepwalker.vo;

import lombok.Data;

/**
 * @package: com.sleepwalker.vo
 * @className: ResultVo
 * @author: SleepWalker
 * @description: 数据和状态码
 * @date: 15:57
 * @version: 1.0
 */
@Data
public class ResultVo<T> {
    private Integer code;
    private T data;
}

```
控制器
```java
@RestController
@RequestMapping("/dormitoryAdmin")
public class DormitoryAdminController {
    @Autowired
    DormitoryAdminService dormitoryAdminService;

    /**
     * @param userForm: 
     * @return ResultVo
     * @author SleepWalker
     * @description 登录
     * @date  16:26
     */
    @GetMapping("/login")
    public ResultVo login(UserForm userForm) {
        return dormitoryAdminService.login(userForm);
    }
}
```
### ④ Service层
```java
@Service
public class DormitoryAdminServiceImpl extends ServiceImpl<DormitoryAdminMapper, DormitoryAdmin> implements DormitoryAdminService {
    @Autowired
    DormitoryAdminMapper dormitoryAdminMapper;

    @Override
    public ResultVo login(UserForm userForm) {
        ResultVo<UserForm> resultVo = new ResultVo<>();

        //1.用户类型是否正确
        if(userForm.getUserType().equals("dormitoryAdmin")){
            resultVo.setCode(-3);
            return resultVo;
        }

        //2.用户是否存在
        QueryWrapper<DormitoryAdmin> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("username", userForm.getUsername());
        DormitoryAdmin dormitoryAdmin = dormitoryAdminMapper.selectOne(queryWrapper);
        if(dormitoryAdmin == null) {
            resultVo.setCode(-1);
        } else {
            //3.密码是否正确
            if(dormitoryAdmin.getPassword().equals(userForm.getPassword())) {
                resultVo.setCode(0);
                resultVo.setData(userForm); //设置表单数据
            } else {
                resultVo.setCode(-2);
            }
        }

        return resultVo;
    }
}
```
### ⑤ Mapper
Mapper继承BaseMapper
![](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665303573585-c44f6e0b-e6e1-40f6-b5f8-9da583fb6881.png#averageHue=%23f2f2f2&clientId=u7d81d083-faec-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&id=ub06149cf&margin=%5Bobject%20Object%5D&originHeight=1380&originWidth=1314&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=u07e6c45a-44b5-4152-b1f6-7eb0f197f59&title=)
### ⑥ 配置文件
```yaml
server:
  port: 8081
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/dormitory?serverTimezone=UTC
    username: root
    password: 166
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  mapper-locations: com/sleepwalker/mapper/xml/*.xml
```
## 2.3 前后端对接
### 解决跨域问题

1. 在目标方法上加@CrossOrigin
2. 添加CROS过滤器
3. 实现WebMvcConfigure接口
```java
@Configuration
public class CorsConfiguration implements WebMvcConfigurer {
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")
                .allowedMethods("GET", "POST", "PUT", "DELETE", "HEAD", "OPTIONS")
                .allowCredentials(true)
                .maxAge(3600)
                .allowedHeaders("*");

    }
}
```
### 前端axios请求
```vue
methods: {
    submitForm(formName) {
      this.$refs[formName].validate((valid) => {
        if (valid) {
          this.logining = true;
          // 回调里用不了this
          let _this = this
          if(_this.userForm.userType === 'dormitoryAdmin') {
            _this.axios.get('http://localhost:8081/dormitoryAdmin/login', {params: _this.userForm}).then(function(resp) {
              _this.logining = false;
              if(resp.data.code == -1){
                _this.$alert('用户不存在!', '提示',  {
                  confirmButtonText: '确定'
                })
              } else if(resp.data.code == -2){
                _this.$alert('密码错误!', '提示',  {
                  confirmButtonText: '确定'
                })
              } else if(resp.data.code == 0) {
                _this.$alert('登录成功!', '提示',  {
                  confirmButtonText: '确定'
                })
              } else {
                _this.$alert('无响应!', '提示',  {
                  confirmButtonText: '确定'
                })
              }
            
            })
          } else {
            _this.$alert('用户类型错误!', '提示',  {
                  confirmButtonText: '确定'
                })
          }

          setTimeout(() => {
            this.logining = false;
          }, 2000);
        } else {
          alert("error submit!!");
          return false;
        }
      });
    },
```
## 2.4 系统管理员登陆
### ① Service层
```java
/**
* <p>
*  服务实现类
* </p>
*
* @author SleepWalker
* @since 2022-10-09
*/
@Service
    public class SystemAdminServiceImpl extends ServiceImpl<SystemAdminMapper, SystemAdmin> implements SystemAdminService {
        @Autowired
        private SystemAdminMapper systemAdminMapper;

        @Override
        public ResultVo login(UserForm userForm) {
            ResultVo<UserForm> resultVo = new ResultVo<>();

            //1.用户是否存在
            QueryWrapper<SystemAdmin> queryWrapper = new QueryWrapper<>();
            queryWrapper.eq("username", userForm.getUsername());
            SystemAdmin systemAdmin = systemAdminMapper.selectOne(queryWrapper);
            if(systemAdmin == null) {
                resultVo.setCode(-1);
            } else {
                //2.密码是否正确
                if(systemAdmin.getPassword().equals(userForm.getPassword())) {
                    resultVo.setCode(0);
                    resultVo.setData(userForm); //设置表单数据
                } else {
                    resultVo.setCode(-2);
                }
            }
            return resultVo;
        }
    }
```
### 2.5 前端菜单路由
### ① 路由跳转
```vue
const routes = [
  {
    path: "/login",
    name: "登录",
    component: Login,
  },
  {
    path: "/systemAdmin",
    name: "系统管理员",
    component: SystemAdmin,
    children: [
      {
        path: "/dormitoryAdminManager",
        name: "宿管管理",
        component: DormitoryAdminManager,
      },
      {
        path: "/dormitoryAdminAdd",
        name: "添加宿管",
        component: DormitoryAdminAdd,
      },
    ],
  },
];
```
### ② 系统管理员页面
```vue
<template>
  <el-container class="home_container">
    <!-- 顶部 -->
    <el-header class="home_header">
      <div class="home_title">DORMS宿舍管理系统-系统管理员</div>
      <div class="home_userinfoContainer">
        <el-dropdown>
          <span class="el-dropdown-link home_userinfo">
            {{ admin.username }}
            <i class="el-icon-arrow-down el-icon--right home_userinfo"></i>
          </span>
          <el-dropdown-menu slot="dropdown">
            <el-dropdown-item @click.native="logout">退出登录</el-dropdown-item>
          </el-dropdown-menu>
        </el-dropdown>
      </div>
    </el-header>

    <!-- 导航栏 -->
    <el-container>
      <el-aside class="home_aside" width="200px">
        <!-- 展开 收起 -->
        <el-radio-group v-model="isCollapse" style="margin-bottom: 5px;margin-top: 5px;"
         fill=''>
          <el-radio-button :label="false">展开</el-radio-button>
          <el-radio-button :label="true">收起</el-radio-button>
        </el-radio-group>

        <!-- router导航 -->
        <el-menu
          router
          :collapse="isCollapse"
          class="el-menu-vertical-demo"
          background-color="#545c64"
          text-color="#fff"
          active-text-color="#ffd04b"
        >
          <!-- 宿管模块 -->
          <el-submenu index="1">
            <template slot="title">
              <i class="el-icon-monitor"></i>
              <span slot="title">宿管模块</span>
            </template>
            <el-menu-item
              index="/dormitoryAdminAdd"
              :class="$route.path == '/dormitoryAdminAdd' ? 'is-active' : ''"
            >
              <i class="el-icon-folder-add"></i>添加宿管
            </el-menu-item>
            <el-menu-item
              index="/dormitoryAdminManager"
              :class="
                $route.path == '/dormitoryAdminManager' ? 'is-active' : ''
              "
            >
              <i class="el-icon-document-copy"></i>宿管管理
            </el-menu-item>
          </el-submenu>

          <!-- 学生模块 -->
          <el-submenu index="2">
            <template slot="title"
              ><i class="el-icon-user-solid"></i>
              <span slot>学生模块</span>
            </template>
            <el-menu-item
              index="/studentAdd"
              :class="$route.path == '/studentAdd' ? 'is-active' : ''"
            >
              <i class="el-icon-folder-add"></i>添加学生
            </el-menu-item>
            <el-menu-item index="/studentManager">
              <i class="el-icon-document-copy"></i>学生管理
            </el-menu-item>
          </el-submenu>

          <!-- 楼宇模块 -->
          <el-submenu index="3">
            <template slot="title"
              ><i class="el-icon-office-building"></i
              ><span slot>楼宇模块</span></template
            >
            <el-menu-item index="/buildingAdd">
              <i class="el-icon-folder-add"></i>添加楼宇
            </el-menu-item>
            <el-menu-item index="/buildingManager">
              <i class="el-icon-document-copy"></i>楼宇管理
            </el-menu-item>
          </el-submenu>

          <!-- 宿舍模块 -->
          <el-submenu index="4">
            <template slot="title"
              ><i class="el-icon-s-home"></i>
              <span slot>宿舍模块</span></template
            >
            <el-menu-item index="/dormitoryAdd">
              <i class="el-icon-folder-add"></i>添加宿舍
            </el-menu-item>
            <el-menu-item index="/dormitoryManager">
              <i class="el-icon-document-copy"></i>宿舍管理
            </el-menu-item>
          </el-submenu>

          <el-menu-item index="/moveoutRegister">
            <i class="el-icon-s-unfold"></i>
            <span slot="title">学生迁出登记</span>
          </el-menu-item>

          <el-menu-item index="/moveoutRecord">
            <i class="el-icon-s-order"></i>
            <span slot="title">学生迁出记录</span>
          </el-menu-item>

          <el-menu-item index="/absentRecord">
            <i class="el-icon-error"></i>
            <span slot="title">学生缺寝记录</span>
          </el-menu-item>
        </el-menu>
      </el-aside>

      <!-- 中间main部分 -->
      <el-container>
        <el-main>
          <el-breadcrumb separator-class="el-icon-arrow-right">
            <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
            <el-breadcrumb-item
              v-text="this.$router.currentRoute.name"
            ></el-breadcrumb-item>
          </el-breadcrumb>
          <router-view></router-view>
        </el-main>

        <!-- footer部分 -->
        <el-footer class="home_footer">2022 © SleepWalker</el-footer>
      </el-container>
    </el-container>
  </el-container>
</template>

<script>
import AboutView from "./AboutView.vue";
export default {
  components: { AboutView },
  name: "SystemAdmin",
  data() {
    return {
      admin: '',
      isCollapse: true,
    };
  },
  methods: {
    logout() {
      this.$confirm('退出登录?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消', 
        type: 'warning'
      }).then(()=>{
        localStorage.removeItem('systemAdmin')
        this.$router.replace({path: '/login'})
      })
    },
  },
  created() {
    this.admin = JSON.parse(window.localStorage.getItem('systemAdmin'))
  }
};
</script>

<style>
.home_container {
  height: 100%;
  position: absolute;
  top: 0px;
  left: 0px;
  width: 100%;
}

.home_header {
  background-color: #0b0332b3;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.home_title {
  color: #c2c2c2;
  font-size: 22px;
  display: inline;
}

.home_userinfo {
  color: rgb(195, 226, 68);
  cursor: pointer;
}

.home_userinfoContainer {
  display: inline;
  margin-right: 20px;
}

.home_aside {
  background-color: #daeae2;
}

.el-menu-vertical-demo:not(.el-menu--collapse) {
  width: 200px;
  min-height: 400px;
}

.home_footer {
  background-color: #ffffff;
  color: #000000;
  font-size: 18px;
  line-height: 60px;
  text-align: center;
}
</style>

```
## 2.5 宿管注册
### ① 前端
```vue
<template xmlns="http://www.w3.org/1999/html">
  <div style="
      margin-top: 60px;
      margin-left: 330px;
      width: 300px;
      height: 500px;
      border: 0px solid red;">
    <fieldset>
      <legend>用户注册</legend>
      <el-form
          :model="ruleForm"
          :rules="rules"
          ref="ruleForm"
          label-width="100px"
          class="demo-ruleForm">
        <el-form-item label="用户名" prop="username">
          <el-input v-model="ruleForm.username"></el-input>
        </el-form-item>
        <el-form-item label="密码" prop="password">
          <el-input v-model="ruleForm.password" placeholder="请输入密码" type="password"></el-input>
        </el-form-item>
        <el-form-item label="确认密码" prop="checkPass">
          <el-input
              type="password"
              placeholder="请输入确认密码"
              v-model="ruleForm.checkPass"
              autocomplete="off"
              show-password
          ></el-input>
        </el-form-item>
        <el-form-item label="姓名" prop="name">
          <el-input v-model="ruleForm.name"></el-input>
        </el-form-item>
        <el-form-item label="性别" prop="gender">
          <div style="width: 170px; height: 30px">
            <template>
              <el-radio v-model="ruleForm.gender" label="男">男</el-radio>
              <el-radio v-model="ruleForm.gender" label="女">女</el-radio>
            </template>
          </div>
        </el-form-item>
        <el-form-item label="联系电话" prop="telephone">
          <el-input v-model.number="ruleForm.telephone"></el-input>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="submitForm('ruleForm')" :loading="logining">立即注册</el-button>
          <el-button @click="resetForm('ruleForm')">重置</el-button>
        </el-form-item>
      </el-form>
      <a :href="login">已有账号？立即登录</a>
    </fieldset>
  </div>
</template>

<script>
export default {
  name: "DormitoryAdminAdd",
  data() {
    var validatePass = (rule, value, callback) => {
      const check = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/;
      if (value === "") {
        callback(new Error("请输入密码"));
      } else {
        if (!check.test(value)) {
          callback(new Error("密码至少包含 数字和英文，长度8-16"));
        }
        callback();
      }
    };
    var validatePass2 = (rule, value, callback) => {
      if (value === "") {
        callback(new Error("请再次输入密码"));
      } else if (value !== this.ruleForm.password) {
        callback(new Error("两次输入密码不一致!"));
      } else {
        callback();
      }
    };
    return {
      category: null,
      logining: false,

      ruleForm: {
        username: "",
        password: "",
        checkPass: "",
        name: "",
        gender: "",
        telephone: "",
      },
      login: 'http://localhost:8080/login',
      rules: {
        username: [
          {required: true, message: "请输入用户名", trigger: "blur"},
          {
            min: 3,
            max: 20,
            message: "长度在 3 到 20 个字符",
            trigger: "blur",
          },
        ],
        password: [{required: true, validator: validatePass, trigger: "blur"}],
        checkPass: [{ validator: validatePass2, trigger: "blur" }],
        name: [{required: true, message: "请输入姓名", trigger: "blur"}],
        gender: [{required: true, message: "请选择性别", trigger: "blur"}],
        telephone: [
          {required: true, message: "请输入联系电话", trigger: "blur"},
        ],
      },
    };
  },
  methods: {
    submitForm(formName) {
      this.$refs[formName].validate((valid) => {
        if (valid) {
          this.logining = true;
          axios.put("http://localhost:8081/dormitoryAdmin/register", this.ruleForm)
              .then((resp) => {
                console.log(resp);
                if (resp.data.code === 0) {
                  this.$alert(this.ruleForm.username + "注册成功", "提示", {
                    confirmButtonText: "确定",
                    callback: (action) => {
                      this.$router.push("/login");
                    },
                  });
                } else if(resp.data.code === -2) {
                  this.$alert(this.ruleForm.username + "用户已存在", "提示", {
                    confirmButtonText: "确定",
                  });
                } else if(resp.data.code === -1) {
                  this.$alert("注册失败", "提示", {confirmButtonText: "确定"},);
                } else {
                  this.$alert("无响应!", "提示", {
                    confirmButtonText: "确定",
                  });
                }
              });

          setTimeout(() => {
            this.logining = false;
          }, 2000);
        }
      });
    },
    resetForm(formName) {
      this.$refs[formName].resetFields();
    },
  },
};
</script>

<style scoped>
fieldset {
  /* 表单页面居中，宽度50% ,legend颜色设置，legend圆角*/
  border: 2px solid #dcdfe6;
  text-align: center;
  border-radius: 8px;
  margin: 0 auto;
  width: 700px;
  padding-top: 50px;
}

#blank {
  height: 100px;
}

.demo-ruleForm {
  width: 500px;
  margin: 0px auto;
}
</style>
```
### ② 后端
Service层
```java
public ResultVo register(DormitoryAdmin dormitoryAdmin) {
    QueryWrapper<DormitoryAdmin> wrapper = new QueryWrapper<>();
    wrapper.eq("username", dormitoryAdmin.getUsername());
    DormitoryAdmin one = getOne(wrapper);

    //用户已存在
    if(one != null) {
        return ResultVOUtil.fail();
    }

    if(save(dormitoryAdmin))
        return ResultVOUtil.success(null);

    return ResultVOUtil.fail();
}
```
### ③ 结果

![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1669168958718-d56a172c-3322-4a03-a9d4-c18481c38d2f.png#averageHue=%23fefefe&clientId=uf4c9b0da-bf11-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=558&id=u6f02f7be&margin=%5Bobject%20Object%5D&name=image.png&originHeight=698&originWidth=923&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25610&status=done&style=none&taskId=u1db615b5-71f2-4c69-8226-f38a84f5d29&title=&width=738.4)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1669168965129-a12e3cd7-5350-4402-8336-f79b849b1791.png#averageHue=%236a5a44&clientId=uf4c9b0da-bf11-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=237&id=ud91ead62&margin=%5Bobject%20Object%5D&name=image.png&originHeight=296&originWidth=684&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16253&status=done&style=none&taskId=u7fda5a6d-548a-41de-8981-242d1d496a9&title=&width=547.2)
成功添加
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1669169000083-bca41231-9f68-485e-83a7-24e85966628d.png#averageHue=%232c3039&clientId=uf4c9b0da-bf11-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=55&id=ub3434bcd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=69&originWidth=1009&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5068&status=done&style=none&taskId=u7b126163-4627-4c58-85e2-ce177a458a6&title=&width=807.2)

# 3. 宿管模块

![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665923184044-4a37ee66-7f7c-426e-b4af-e5a388f28ee8.png#averageHue=%23e9f1d7&clientId=ufb8e8784-1cb5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=480&id=ua70d10bb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=600&originWidth=1788&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49954&status=done&style=none&taskId=u05436d3c-ecee-4dbf-a542-e134a5ae199&title=&width=1430.4)
## 3.1 添加宿管
### ① 页面
```vue
<template>
     <div style="margin-top: 60px;margin-left:330px;width: 300px;height: 500px;border: 0px solid red;" >
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="用户名" prop="username">
                <el-input v-model="ruleForm.username"></el-input>
            </el-form-item>
            <el-form-item label="密码" prop="password">
                <el-input v-model="ruleForm.password"></el-input>
            </el-form-item>
            <el-form-item label="姓名" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>
            <el-form-item label="性别" prop="gender">
                <div style="width: 170px;height: 30px;">
                    <template>
                        <el-radio v-model="ruleForm.gender" label="男">男</el-radio>
                        <el-radio v-model="ruleForm.gender" label="女">女</el-radio>
                    </template>
                </div>
            </el-form-item>
            <el-form-item label="联系电话" prop="telephone">
                <el-input v-model.number="ruleForm.telephone"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即创建</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>
</template>

<script>
export default {
    name: 'DormitoryAdminAdd',
     data() {
            return {
                category:null,
                ruleForm: {
                    username: '',
                    password: '',
                    name: '',
                    gender: '',
                    telephone: ''
                },
                rules: {
                    username: [
                        { required: true, message: '请输入用户名', trigger: 'blur' }
                    ],
                    password: [
                        { required: true, message: '请输入密码', trigger: 'blur' }
                    ],
                    name: [
                        { required: true, message: '请输入姓名', trigger: 'blur' }
                    ],
                    gender: [
                        { required: true, message: '请选择性别', trigger: 'change' }
                    ],
                    telephone: [
                        { required: true, message: '请输入联系电话', trigger: 'blur' }
                    ]
                }
            };
        },
        methods: {
            submitForm(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios.post('http://localhost:8181/dormitoryAdmin/save',this.ruleForm).then((resp)=>{
                            if(resp.data.code == 0){
                                this.$alert(this.ruleForm.username+'添加成功', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        this.$router.push('/dormitoryAdminManager')
                                    }
                                });
                            }
                        })
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        }
}
</script>

<style>

</style>
```
### ② 处理添加
结果工具类
```java
public class ResultVOUtil {
    /**
* @param object: 
* @return ResultVo
* @author SleepWalker
* @description 成功,code为0
* @date  20:27
*/
    public static ResultVo success(Object object) {
        ResultVo resultVo = new ResultVo();
        resultVo.setCode(0);
        resultVo.setData(object);
        return resultVo;
    }

    /**
* @param : 
* @return ResultVo
* @author SleepWalker
* @description 失败, 码为-1
* @date  20:28
*/
    public static ResultVo fail() {
        ResultVo resultVo = new ResultVo();
        resultVo.setCode(-1);
        return resultVo;
    }
}
```
控制器
```java
@PostMapping("/save")
public ResultVo save(@RequestBody DormitoryAdmin dormitoryAdmin) {
    boolean save = dormitoryAdminService.save(dormitoryAdmin);
    if(save)
        return ResultVOUtil.success(null);
    else
        return ResultVOUtil.fail();
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665407081914-4e3372e0-0d61-4b85-b45a-73bff26ab760.png#averageHue=%23fefefe&clientId=u00336cf2-40e1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=409&id=ua3221413&margin=%5Bobject%20Object%5D&name=image.png&originHeight=511&originWidth=511&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10924&status=done&style=none&taskId=u3ed78549-9767-4c41-9343-297f2349f31&title=&width=408.8)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665407095959-4910b610-8b2a-4ccf-88d0-510d45a6007b.png#averageHue=%232b373e&clientId=u00336cf2-40e1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=70&id=u621e9197&margin=%5Bobject%20Object%5D&name=image.png&originHeight=88&originWidth=1009&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5918&status=done&style=none&taskId=u7aab1d24-c985-48be-9aa7-3b8f9df3313&title=&width=807.2)
## 3.2 分页查询
### ① 前端视图
```vue
<template>
    <div style="margin-top: 60px;margin-left:80px;border: 0px solid red;" >
        <el-form style="margin-left: -40px" :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="字段：" prop="key">
                <el-select v-model="ruleForm.key" style="width: 160px;float: left" placeholder="请选择字段">
                    <el-option label="宿管账号" value="username"></el-option>
                    <el-option label="宿管姓名" value="name"></el-option>
                    <el-option label="宿管电话" value="telephone"></el-option>
                </el-select>
            </el-form-item>
            <div style="border: 0px solid red;width: 400px;height: 60px;position: relative;top: -64px;left: 270px">
                <el-form-item label="值：">
                    <el-input v-model="ruleForm.value" placeholder="请输入关键字" style="width: 160px;"></el-input>
                    <el-button type="primary" icon="el-icon-search" style="position: relative;left: 10px;" @click="submitForm('ruleForm')">搜索</el-button>
                </el-form-item>
            </div>
        </el-form>

        <el-table
                :data="tableData"
                border
                stripe
                style="width: 100%;position: relative;top:-30px">
            <el-table-column
                    fixed
                    prop="id"
                    label="ID"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="username"
                    label="用户名"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="password"
                    label="密码"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="name"
                    label="姓名"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="gender"
                    label="性别"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="telephone"
                    label="联系电话"
                    width="160">
            </el-table-column>
            <el-table-column label="操作">
                <template slot-scope="scope">
                    <el-button
                            size="mini"
                            @click="edit(scope.row)">编辑</el-button>
                    <el-button
                            size="mini"
                            type="danger"
                            @click="del(scope.row)">删除</el-button>
                </template>
            </el-table-column>
        </el-table>
        <el-pagination style="margin-top: 20px;float: right"
                       background
                       layout="prev, pager, next"
                       :page-size="pageSize"
                       :total="total"
                       :current-page.sync="currentPage"
                       @current-change="page">
        </el-pagination>
    </div>
</template>

<script>
    export default {
        data() {
            return {
                tableData:null,
                currentPage: 1,
                pageSize: 3,
                total: 0,
                key: '',
                value: '',
                ruleForm: {
                    key: '',
                    value: '',
                    page: '',
                    size: 3
                },
                rules: {
                    key: [
                        { required: true, message: '请选择字段', trigger: 'change' }
                    ]
                }
            }
        },
        methods:{
            submitForm(formName) {
                const _this = this
                //让翻页复原
                _this.currentPage = 1
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        const _this = this
                        _this.ruleForm.page = _this.currentPage
                        axios.get('http://localhost:8181/dormitoryAdmin/search',{params:_this.ruleForm}).then(function (resp) {
                            _this.tableData = resp.data.data.data
                            _this.total = resp.data.data.total
                        })
                    }
                });
            },
            page(currentPage){
                const _this = this
                if(_this.ruleForm.value == ''){
                    axios.get('http://localhost:8081/dormitoryAdmin/list/'+currentPage+'/'+_this.pageSize).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                } else {
                    _this.ruleForm.page = _this.currentPage
                    axios.get('http://localhost:8081/dormitoryAdmin/search',{params:_this.ruleForm}).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                }
            },
            edit(row){
                this.$router.push('/dormitoryAdminUpdate?id='+row.id)
            },
            del(row) {
                const _this = this
                this.$confirm('确认删除【'+row.username+'】吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete('http://localhost:8081/dormitoryAdmin/deleteById/'+row.id).then(function (resp) {
                        if(resp.data.code==0){
                            _this.$alert('【'+row.username+'】已删除', '', {
                                confirmButtonText: '确定',
                                callback: action => {
                                    location.reload()
                                }
                            });
                        }
                    });
                });
            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/dormitoryAdmin/list/1/'+_this.pageSize).then(function (resp) {
                _this.tableData = resp.data.data.data
                _this.total = resp.data.data.total
            })
        }
    }
</script>

<style>

</style>
```
### ② 后端
分页配置类
```java
package com.sleepwalker.config;

import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class PageConfiguration {

    @Bean
    public PaginationInterceptor paginationInterceptor(){
        return new PaginationInterceptor();
    }
}

```
Service
```java
@Override
public PageVO list(Integer page, Integer size) {
    Page<DormitoryAdmin> dormitoryAdminPage = new Page<>(page, size);
    Page<DormitoryAdmin> resultPage = dormitoryAdminMapper.selectPage(dormitoryAdminPage, null);
    PageVO pageVO = new PageVO();
    pageVO.setData(resultPage.getRecords());
    pageVO.setTotal(resultPage.getTotal());

    return pageVO;
}
```
Controller
```java
@GetMapping("/list/{page}/{size}")
public ResultVo list(@PathVariable("page") Integer page, @PathVariable("size") Integer size) {
    return ResultVOUtil.success(dormitoryAdminService.list(page, size));
}
```
## 3.3 搜索功能
### ① 前端
```vue
 page(currentPage){
    const _this = this
    if(_this.ruleForm.value == ''){
        axios.get('http://localhost:8081/dormitoryAdmin/list/'+currentPage+'/'+_this.pageSize).then(function (resp) {
            _this.tableData = resp.data.data.data
            _this.total = resp.data.data.total
        })
    } else {
        _this.ruleForm.page = _this.currentPage
        axios.get('http://localhost:8081/dormitoryAdmin/search',{params:_this.ruleForm}).then(function (resp) {
            _this.tableData = resp.data.data.data
            _this.total = resp.data.data.total
        })
    }
},
```
搜索框为空时

- 不能用list的请求, 要用search的请求
- 否则查询的数据不是搜索的数据, 是没有经过模糊搜索的数据

```vue
submitForm(formName) {
    const _this = this
    //让翻页复原
    _this.currentPage = 1
    this.$refs[formName].validate((valid) => {
        if (valid) {
            const _this = this
            _this.ruleForm.page = _this.currentPage
            axios.get('http://localhost:8081/dormitoryAdmin/search',{params:_this.ruleForm}).then(function (resp) {
                _this.tableData = resp.data.data.data
                _this.total = resp.data.data.total
            })
        }
    });
},
```
按下搜索提交表单时, 将当前页复原, 设置为第一页
否则在第2页按下搜索时, 搜索完后的结果也会在第2页
### ② 后端
Data
```java
@Data
public class SearchForm {
    private String key;
    private String value;
    private Integer page;
    private Integer size;
}
```
Service
```java
 @Override
public PageVO search(SearchForm searchForm) {
    Page<DormitoryAdmin> dormitoryAdminPage = new Page<>(searchForm.getPage(), searchForm.getSize());
    Page<DormitoryAdmin> resultPage = null;

    if(searchForm.getValue().equals("")) { //搜索为空
        resultPage = dormitoryAdminMapper.selectPage(dormitoryAdminPage, null);
    } else {
        QueryWrapper<DormitoryAdmin> queryWrapper = new QueryWrapper<>();
        queryWrapper.like(searchForm.getKey(), searchForm.getValue());
        resultPage = dormitoryAdminMapper.selectPage(dormitoryAdminPage, queryWrapper);
    }

    PageVO pageVo = new PageVO();
    pageVo.setData(resultPage.getRecords());
    pageVo.setTotal(resultPage.getTotal());

    return pageVo;
}
```
Controller
```java
@GetMapping("/search")
public ResultVo search(SearchForm searchForm) {
    return ResultVOUtil.success(dormitoryAdminService.search(searchForm));
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665909907075-9582dd13-77cd-4e71-b2a3-0da6a783996c.png#averageHue=%23fefcfc&clientId=u02e8ee56-f8ff-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=413&id=u054ccf92&margin=%5Bobject%20Object%5D&name=image.png&originHeight=516&originWidth=1565&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37466&status=done&style=none&taskId=u90ca0158-d2fe-41c7-8967-82b5386931d&title=&width=1252)
## 3.4 修改宿管
### ① 前端
```vue
<template>
    <div style="margin-top: 60px;margin-left:330px;width: 300px;height: 500px;border: 0px solid red;" >
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="ID">
                <el-input v-model="ruleForm.id" readonly></el-input>
            </el-form-item>
            <el-form-item label="用户名" prop="username">
                <el-input v-model="ruleForm.username"></el-input>
            </el-form-item>
            <el-form-item label="密码" prop="password">
                <el-input v-model="ruleForm.password"></el-input>
            </el-form-item>
            <el-form-item label="姓名" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>
            <el-form-item label="性别">
                <div style="width: 170px;height: 30px;">
                    <template>
                        <el-radio v-model="ruleForm.gender" label="男">男</el-radio>
                        <el-radio v-model="ruleForm.gender" label="女">女</el-radio>
                    </template>
                </div>
            </el-form-item>
            <el-form-item label="联系电话" prop="telephone">
                <el-input v-model.number="ruleForm.telephone"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即修改</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                category:null,
                ruleForm: {
                    username: '',
                    password: '',
                    name: '',
                    gender: '男',
                    telephone: ''
                },
                rules: {
                    username: [
                        { required: true, message: '请输入用户名', trigger: 'blur' }
                    ],
                    password: [
                        { required: true, message: '请输入密码', trigger: 'blur' }
                    ],
                    name: [
                        { required: true, message: '请输入姓名', trigger: 'blur' }
                    ],
                    telephone: [
                        { required: true, message: '请输入联系电话', trigger: 'blur' }
                    ]
                }
            };
        },
        methods: {
            submitForm(formName) {
                const _this = this
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios.put('http://localhost:8081/dormitoryAdmin/update',_this.ruleForm).then(function (resp) {
                            if(resp.data.code == 0){
                                _this.$alert(_this.ruleForm.username+'修改成功', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        _this.$router.push('/dormitoryAdminManager')
                                    }
                                });
                            }
                        })
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/dormitoryAdmin/findById/'+_this.$route.query.id).then(function (resp) {
                _this.ruleForm = resp.data.data
            })
        }
    }
</script>

```
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665920391581-d39f6533-28dd-4cb5-bd74-c6789ecbf3bd.png#averageHue=%2327343b&clientId=u02e8ee56-f8ff-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=150&id=ucd95d2df&margin=%5Bobject%20Object%5D&name=image.png&originHeight=187&originWidth=745&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26372&status=done&style=none&taskId=uc04153ad-1d94-40c4-b1c5-da83b73e0b2&title=&width=596)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665920380912-9c206604-c4c7-4b92-9b01-31c03eddfd58.png#averageHue=%2328353c&clientId=u02e8ee56-f8ff-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=90&id=u38fafe1a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=113&originWidth=753&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13543&status=done&style=none&taskId=ubc57ab04-40f1-4de4-b8fd-f5433318631&title=&width=602.4)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665920446173-78a2775c-627a-4d9f-ac22-25d7b6b5b2f6.png#averageHue=%2328353b&clientId=u02e8ee56-f8ff-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=124&id=ua003b3a0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=155&originWidth=494&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15016&status=done&style=none&taskId=u1a66391a-e428-4605-a911-d4cea9f0443&title=&width=395.2)
点击编辑后, vue路由跳转到修改界面
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665920495433-1a4b9315-3556-47ac-911a-b8961b536531.png#averageHue=%23263239&clientId=u02e8ee56-f8ff-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=146&id=u5cd5fdea&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=1363&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29534&status=done&style=none&taskId=ubb34d646-7041-4ddb-a1d6-5dc2c8d5a24&title=&width=1090.4)
在修改界面创建时, 先发送请求得到id的宿管数据, 赋值给与视图绑定的数据

### ② 后端
Service
单表修改和查询, 用的都是IService中的方法
Controller
```java
@GetMapping("/findById/{id}")
public ResultVo findById(@PathVariable Integer id) {
    return ResultVOUtil.success(dormitoryAdminService.getById(id));
}

@PutMapping("/update")
public ResultVo update(@RequestBody DormitoryAdmin dormitoryAdmin) {
    boolean update = dormitoryAdminService.updateById(dormitoryAdmin);
    if(update) {
        return ResultVOUtil.success(null);
    } else {
        return ResultVOUtil.fail();
    }
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665921314722-fa72b3f6-ca37-4b82-ba0e-3391fef52911.png#averageHue=%23fefefe&clientId=u02e8ee56-f8ff-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=498&id=uc64e699d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=623&originWidth=636&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19375&status=done&style=none&taskId=u4237e99a-1046-4f6e-a2b0-4e1e276f47c&title=&width=508.8)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665921322278-a6371d5c-5b6b-4756-bd47-353debe84eb3.png#averageHue=%23ababab&clientId=u02e8ee56-f8ff-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=282&id=u0256c036&margin=%5Bobject%20Object%5D&name=image.png&originHeight=353&originWidth=629&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15305&status=done&style=none&taskId=uf264839f-acfb-49f8-8619-a230e7818ee&title=&width=503.2)


## 3.5 删除宿管
### ① 前端
```vue
 del(row) {
  const _this = this
  this.$confirm('确认删除【'+row.username+'】吗？', '提示', {
      confirmButtonText: '确定',
      cancelButtonText: '取消',
      type: 'warning'
  }).then(() => {
      axios.delete('http://localhost:8081/dormitoryAdmin/deleteById/'+row.id).then(function (resp) {
          if(resp.data.code==0){
              _this.$alert('【'+row.username+'】已删除', '', {
                  confirmButtonText: '确定',
                  callback: action => {
                      location.reload()
                  }
              });
          }
      });
  }).catch(() => {
      this.$message({
          type: 'info', 
          message: '已取消删除',
      })
  });
}
```
点击确定就发送请求
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665923039946-a79be10b-0389-4cce-8a37-fb4ac96f6830.png#clientId=ufb8e8784-1cb5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=161&id=u719439f9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=201&originWidth=391&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16447&status=done&style=none&taskId=u96df4b88-e2d6-48f8-9093-0acc7bd9500&title=&width=312.8)
点击取消则是弹出一条消息

### ② 后端
Service
单表修改和查询, 用的都是IService中的方法
Controller
```java
 @ApiOperation("删除宿管")
    @DeleteMapping("/deleteById/{id}")
    public ResultVo deleteById(@PathVariable Integer id) {
        if(dormitoryAdminService.removeById(id))
            return ResultVOUtil.success(null);
        return ResultVOUtil.fail();
    }
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665922776272-523ad28e-693b-4c99-a956-b2672736ec13.png#averageHue=%23c4c4c4&clientId=ufb8e8784-1cb5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=201&id=u4343a524&margin=%5Bobject%20Object%5D&name=image.png&originHeight=251&originWidth=644&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11439&status=done&style=none&taskId=u8e6d8849-6e78-4b02-aee1-51e80f0cc2a&title=&width=515.2)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665922830491-4df6ed71-2ada-4c26-903a-b6d359618424.png#averageHue=%23b7b6b6&clientId=ufb8e8784-1cb5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=169&id=u18a5156c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=237&originWidth=741&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8532&status=done&style=none&taskId=u878ca453-1ae2-42cd-a21e-05ef2f428a1&title=&width=528.7999877929688)

# 4. 学生模块
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666183178403-e94587e8-4b6a-46c6-bdc3-0a3b9e1bf4bc.png#averageHue=%23e7f0d4&clientId=uc57c5ab0-2f53-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=351&id=uc92a462a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=439&originWidth=1663&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33975&status=done&style=none&taskId=u44132e53-337e-40d2-8cf1-e0359939d75&title=&width=1330.4)
## 4.1 添加学生
### ① 前端
```vue
<template>
    <div
            style="
      margin-top: 60px;
      margin-left: 330px;
      width: 300px;
      height: 500px;
      border: 0px solid red;
    "
    >
        <el-form
                :model="ruleForm"
                :rules="rules"
                ref="ruleForm"
                label-width="100px"
                class="demo-ruleForm"
        >
            <el-form-item label="学号" prop="number">
                <el-input v-model="ruleForm.number"></el-input>
            </el-form-item>
            <el-form-item label="姓名" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>
            <el-form-item label="性别" prop="gender">
                <div style="width: 170px; height: 30px">
                    <template>
                        <el-radio v-model="ruleForm.gender" label="男">男</el-radio>
                        <el-radio v-model="ruleForm.gender" label="女">女</el-radio>
                    </template>
                </div>
            </el-form-item>
            <el-form-item label="宿舍" prop="telephone">
                <el-select v-model="ruleForm.dormitoryId" placeholder="请选择宿舍">
                    <el-option
                            v-for="item in dormitoryList"
                            :label="item.name"
                            :value="item.id"
                            :key="item.id"
                    ></el-option>
                </el-select>
            </el-form-item>

            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')"
                >立即创建
                </el-button
                >
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>
</template>

<script>
    export default {
        data() {
            return {
                category: null,
                ruleForm: {
                    number: "",
                    name: "",
                    gender: "",
                    dormitoryId: "",
                },
                dormitoryList: "",
                rules: {
                    number: [{required: true, message: "请输入学号", trigger: "blur"}],
                    name: [{required: true, message: "请输入姓名", trigger: "blur"}],
                    gender: [{required: true, message: "请输入性别", trigger: "blur"}],
                    dormitoryId: [
                        {required: true, message: "请选择宿舍", trigger: "change"},
                    ],
                },
            };
        },
        methods: {
            submitForm(formName) {
                this.$refs[formName].validate((valid) => {
                    axios.post('http://localhost:8081/student/save', this.ruleForm).then((response) => {
                      if(response.data.code === 0) {
                        this.$alert(this.ruleForm.name + '添加成功', '', {
                          confirmButtonText: '确定',
                          callback: action => {
                            this.$route.push('/studentManager')
                          }
                        })
                      }
                    })
                })
            },
          resetForm(formName) {
              this.$refs[formName].resetField();
          }
        },
      created() {
          axios.get('http://localhost:8081/dormitory/availableList').then((response) => {
            this.dormitoryList = response.data.data
          })
      }
    };
</script>

<style>
</style>
```
点击确定就发送请求
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665923039946-a79be10b-0389-4cce-8a37-fb4ac96f6830.png#averageHue=%2327343b&clientId=ufb8e8784-1cb5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=161&id=bhiqy&margin=%5Bobject%20Object%5D&name=image.png&originHeight=201&originWidth=391&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16447&status=done&style=none&taskId=u96df4b88-e2d6-48f8-9093-0acc7bd9500&title=&width=312.8)
点击取消则是弹出一条消息

### ② 后端
Service
```java
public Boolean mySave(Student student) {
    //添加学生
    student.setCreateDate(CommonUtil.createDate());
    int save = studentMapper.insert(student);
    if(save != 1)
        return false;

    //宿舍可住人员-1
    Dormitory dormitory = dormitoryMapper.selectById(student.getDormitoryId());
    if(dormitory.getAvailable() == 0)
        return false;

    dormitory.setAvailable(dormitory.getAvailable() - 1);
    int update = dormitoryMapper.updateById(dormitory);
    if(update != 1)
        return false;

    return true;
}
```
添加完学生后, 宿舍可住人数也要减一
Controller
```java
@ApiOperation("添加学生")
@PostMapping("/save")
public ResultVo save(@RequestBody Student student) {
    if(studentService.mySave(student)) return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666021560097-c3b555b6-0015-42bd-badc-3856ceab26e7.png#averageHue=%23fefefe&clientId=udefa6e5d-33da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=402&id=u1357a48e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=503&originWidth=518&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11980&status=done&style=none&taskId=u5d1b2d4c-db03-4066-a459-42b1c45895e&title=&width=414.4)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666021555639-90bfba8e-39eb-42d1-8232-30d09b34ac08.png#averageHue=%23989898&clientId=udefa6e5d-33da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=418&id=u5d4e08e1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=522&originWidth=734&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13820&status=done&style=none&taskId=uee6d90b2-840d-459b-9e12-dce963aab5b&title=&width=587.2)
## 4.2 学生管理
### ① 前端
```vue
<template>
    <div style="margin-top: 60px;margin-left:80px;border: 0px solid red;">
        <el-form style="margin-left: -40px" :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px"
                 class="demo-ruleForm">
            <el-form-item label="字段：" prop="key">
                <el-select v-model="ruleForm.key" style="width: 160px;float: left" placeholder="请选择字段">
                    <el-option label="学号" value="number"></el-option>
                    <el-option label="姓名" value="name"></el-option>
                </el-select>
            </el-form-item>
            <div style="border: 0px solid red;width: 400px;height: 60px;position: relative;top: -64px;left: 270px">
                <el-form-item label="值：">
                    <el-input v-model="ruleForm.value" placeholder="请输入关键字" style="width: 160px;"></el-input>
                    <el-button type="primary" icon="el-icon-search" style="position: relative;left: 10px;"
                               @click="submitForm('ruleForm')">搜索
                    </el-button>
                </el-form-item>
            </div>
        </el-form>

        <el-table
                :data="tableData"
                border
                stripe
                style="width: 100%;position: relative;top:-30px">
            <el-table-column
                    fixed
                    prop="id"
                    label="ID"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="dormitoryName"
                    label="宿舍"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="number"
                    label="学号"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="name"
                    label="姓名"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="gender"
                    label="性别"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="state"
                    label="状态"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="createDate"
                    label="入住时间"
                    width="140">
            </el-table-column>
            <el-table-column label="操作">
                <template slot-scope="scope">
                    <el-button
                            size="mini"
                            @click="edit(scope.row)">编辑
                    </el-button>
                    <el-button
                            size="mini"
                            type="danger"
                            @click="del(scope.row)">删除
                    </el-button>
                </template>
            </el-table-column>
        </el-table>
        <el-pagination style="margin-top: 20px;float: right"
                       background
                       layout="prev, pager, next"
                       :page-size="pageSize"
                       :total="total"
                       :current-page.sync="currentPage"
                       @current-change="page">
        </el-pagination>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                tableData: null,
                currentPage: 1,
                pageSize: 5,
                total: null,
                key: '',
                value: '',
                ruleForm: {
                    key: '',
                    value: '',
                    page: '',
                    size: 5
                },
                rules: {
                    key: [
                        {required: true, message: '请选择字段', trigger: 'change'}
                    ]
                }
            }
        },
        methods: {
            submitForm(formName) {
                //让翻页复原
                this.currentPage = 1
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        this.ruleForm.page = _this.currentPage
                        axios.get('http://localhost:8081/student/search', {params: this.ruleForm}).then((resp) => {
                            this.tableData = resp.data.data.data
                            this.total = resp.data.data.total
                        })
                    }
                });

            },
            page(currentPage) {
                if (this.ruleForm.value === '') {
                    axios.get('http://localhost:8081/student/list/' + currentPage + '/' + this.pageSize).then((resp) => {
                        this.tableData = resp.data.data.data
                        this.total = resp.data.data.total
                    })
                } else {
                    this.ruleForm.page = this.currentPage
                    axios.get('http://localhost:8081/student/search', {params: this.ruleForm}).then((resp) => {
                        this.tableData = resp.data.data.data
                        this.total = resp.data.data.total
                    })
                }

            },
            edit(row) {
                this.$router.push('/studentUpdate?id=' + row.id)
            },
            del(row) {
                this.$confirm('确认删除【' + row.name + '】吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete('http://localhost:8081/student/deleteById/' + row.id).then((resp) => {
                        if (resp.data.code === 0) {
                            this.$alert('【' + row.name + '】已删除', '', {
                                confirmButtonText: '确定',
                                callback: action => {
                                    location.reload()
                                }
                            });
                        }
                    });
                });
            }
        },
        created() {
            axios.get('http://localhost:8081/student/list/1/' + this.pageSize).then((resp) => {
                this.tableData = resp.data.data.data
                this.total = resp.data.data.total
            })
        }
    }
</script>
```
### ② 后端
PageVO
```java
@Data
public class PageVO {
    private Object data;
    private Long total;
}
```
Service
```java
@Override
public PageVO list(Integer page, Integer size) {
    Page<Student> studentPage = new Page<>(page, size);
    Page<Student> resultPage = studentMapper.selectPage(studentPage, null);
    //转换成VO
    List<Student> studentList = resultPage.getRecords();
    List<StudentVO> studentVOList = new ArrayList<>();
    for(Student student : studentList) {
        StudentVO studentVO = new StudentVO();
        BeanUtils.copyProperties(student, studentVO);
        studentVO.setDormitoryName(dormitoryMapper.selectById(student.getDormitoryId()).getName());
        studentVOList.add(studentVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setData(studentVOList);
    pageVO.setTotal(resultPage.getTotal());
    return pageVO;
}
```
`BeanUtils.copyProperties(student, studentVO);`直接将相同属性(类型和属性名都一致)复制给后面的对象

Controller
```java
@ApiOperation("分页查询学生信息")
@GetMapping("/list/{page}/{size}")
public ResultVo list(@PathVariable("page") Integer page, @PathVariable("size") Integer size) {
    return ResultVOUtil.success(studentService.list(page, size));
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666021139121-3fc8d294-6c95-4ab2-834c-d42fc1bc2925.png#clientId=udefa6e5d-33da-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=583&id=uffa20405&margin=%5Bobject%20Object%5D&name=image.png&originHeight=729&originWidth=1639&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54525&status=done&style=none&taskId=ud1c7e5a3-60af-43c5-96ad-c9f90a290a6&title=&width=1311.2)
## 4.3 搜索
### ① 前端
与4.2一致。
### ② 后端
Service
```java
@Override
public PageVO search(SearchForm searchForm) {
    Page<Student> studentPage = new Page<>(searchForm.getPage(), searchForm.getSize());
    Page<Student> resultPage = null;
    if(searchForm.getValue().equals("")) {  //搜索框为空
        resultPage = studentMapper.selectPage(studentPage, null);
    } else {
        QueryWrapper<Student> queryWrapper = new QueryWrapper<>();
        queryWrapper.like(searchForm.getKey(), searchForm.getValue());
        resultPage = studentMapper.selectPage(studentPage, queryWrapper);
    }

    //转换成VO
    List<Student> studentList = resultPage.getRecords();
    List<StudentVO> studentVOList = new ArrayList<>();
    for(Student student : studentList) {
        StudentVO studentVO = new StudentVO();
        //复制相同属性
        BeanUtils.copyProperties(student, studentVO);
        studentVO.setDormitoryName(dormitoryMapper.selectById(student.getDormitoryId()).getName());
        studentVOList.add(studentVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setData(studentVOList);
    pageVO.setTotal(resultPage.getTotal());
    return pageVO;
}
```

Controller
```java
 @GetMapping("/search")
public ResultVo search(SearchForm searchForm) {
    return ResultVOUtil.success(studentService.search(searchForm));
}

```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666106983298-1037a07b-d3bc-4db6-ab91-384617073c9d.png#averageHue=%23fdfcfc&clientId=udcba4a12-6bab-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=536&id=uec05bc29&margin=%5Bobject%20Object%5D&name=image.png&originHeight=670&originWidth=1543&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49500&status=done&style=none&taskId=u541726cb-7f66-404b-b8a5-f6a5fa038f0&title=&width=1234.4)
## 4.4 修改学生信息
### ① 前端
```vue
<template>
    <div style="margin-top: 60px;margin-left:330px;width: 300px;height: 500px;border: 0px solid red;" >
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="ID">
                <el-input v-model="ruleForm.id" readonly></el-input>
            </el-form-item>
            <el-form-item label="学号" prop="number">
                <el-input v-model="ruleForm.number"></el-input>
            </el-form-item>
            <el-form-item label="姓名" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>
            <el-form-item label="性别" prop="gender">
                <div style="width: 170px;height: 30px;">
                    <template>
                        <el-radio v-model="ruleForm.gender" label="男">男</el-radio>
                        <el-radio v-model="ruleForm.gender" label="女">女</el-radio>
                    </template>
                </div>
            </el-form-item>
            <el-form-item label="宿舍：" prop="dormitoryId">
                <el-select v-model="ruleForm.dormitoryId" placeholder="请选择宿舍">
                    <el-option v-for="item in dormitoryList" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即修改</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                category:null,
                ruleForm: {
                    number: '',
                    name: '',
                    gender: '男',
                    dormitoryId: ''
                },
                dormitoryList: '',
                rules: {
                    number: [
                        { required: true, message: '请输入学号', trigger: 'blur' }
                    ],
                    name: [
                        { required: true, message: '请输入姓名', trigger: 'blur' }
                    ],
                    gender: [
                        { required: true, message: '请输入性别', trigger: 'blur' }
                    ],
                    dormitoryId: [
                        { required: true, message: '请选择宿舍', trigger: 'change' }
                    ]
                }
            };
        },
        methods: {
            submitForm(formName) {
                const _this = this
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios.put('http://localhost:8081/student/update',_this.ruleForm).then(function (resp) {
                            if(resp.data.code === 0){
                                _this.$alert(_this.ruleForm.name+'修改成功', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        _this.$router.push('/studentManager')
                                    }
                                });
                            }
                        })
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/dormitory/availableList').then(function (resp) {
                _this.dormitoryList = resp.data.data
            })
            axios.get('http://localhost:8081/student/findById/'+_this.$route.query.id).then(function (resp) {
                _this.ruleForm = resp.data.data
            })
        }
    }
</script>

```
### ② 后端
Mapper
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sleepwalker.mapper.StudentMapper">
  <update id="subAvailable" parameterType="Integer">
    update dormitory.dormitory set available = available - 1 where id = #{id}
  </update>

  <update id="addAvailable">
    update dormitory.dormitory set available = available + 1 where id = #{id}
  </update>
</mapper>

```
如果使用BaseMapper中的方法，更新一个宿舍需要调用两个语句，selectById拿到available和updateById更新available。

Service
```java
@Override
public Boolean update(StudentForm studentForm) {
    //学生信息
    Student student = new Student();
    BeanUtils.copyProperties(studentForm, student);
    int update = studentMapper.updateById(student);
    if(update != 1)
        return false;

    //宿舍余量更改
    if(!studentForm.getDormitoryId().equals(studentForm.getOldDormitoryId())) {
        try {
            //原来宿舍余量+1
            studentMapper.addAvailable(studentForm.getDormitoryId());
            //新宿舍余量+1
            studentMapper.subAvailable(studentForm.getOldDormitoryId());
        } catch (Exception e) {
            return false;
        }
    }

    return true;
}
```
若学生更换宿舍，宿舍的可住余量也要更改。

StudentForm
```java
package com.sleepwalker.form;
import lombok.Data;

@Data
public class StudentForm {
    private Integer id;
    private Integer number;
    private String name;
    private String gender;
    private Integer dormitoryId;
    private Integer oldDormitoryId;
    private String state = "入住";
    private String createDate;

}

```
Controller
```java
 @GetMapping("/findById/{id}")
public ResultVo findById(@PathVariable("id") Integer id) {
    Student student = studentService.getById(id);
    StudentForm studentForm = new StudentForm();
    BeanUtils.copyProperties(student, studentForm);
    studentForm.setOldDormitoryId(student.getDormitoryId());

    return ResultVOUtil.success(studentForm);
}
```
在student的基础上，添加一个oldDormitoryId。
新的宿舍id会覆盖掉旧的宿舍id，表单上只有一宿舍id，所以添加一个宿舍id就不会被覆盖掉。
这个旧宿舍id不会用来显示在页面上，只是存储下来，更新学生信息的时候就有旧的宿舍id和新的宿舍id。这样就不需要在学生信息更新前，根据学生id查出旧的宿舍id。
```java
@PutMapping("/update")
public ResultVo update(@RequestBody StudentForm studentForm) {
    if(studentService.update(studentForm))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```
除了get请求，其他请求的参数都要加上@RequestBody。

pom.xml
```xml
 <resources>
    <resource>
        <directory>src/main/java</directory>
        <includes>
            <include>**/*.xml</include>
        </includes>
    </resource>
</resources>
```
因为Mapper映射文件没有放在resource包下，不能找到。在pom.xml中加上该代码就能识别非resource包下的映射文件。
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666105329704-7b8848d7-6217-4158-b91e-8b59caaa1e89.png#clientId=udcba4a12-6bab-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=397&id=ue14d1093&margin=%5Bobject%20Object%5D&name=image.png&originHeight=592&originWidth=530&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13188&status=done&style=none&taskId=uf1a73609-5580-4089-9799-3c3f2a239bf&title=&width=355)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666105350196-f99b4aed-329c-4187-b333-99c183cad1af.png#clientId=udcba4a12-6bab-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=97&id=ubc8f9278&margin=%5Bobject%20Object%5D&name=image.png&originHeight=202&originWidth=1137&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12583&status=done&style=none&taskId=ud665a4ea-f148-42f7-a66a-c81b2fbe816&title=&width=548)
修改后
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666105359721-87c22d4c-0ee6-401d-bff8-e65d87f63ddb.png#clientId=udcba4a12-6bab-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=347&id=u6f91bf79&margin=%5Bobject%20Object%5D&name=image.png&originHeight=550&originWidth=860&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15123&status=done&style=none&taskId=u8e7bd69c-f312-4be0-bed1-0aea9127d3e&title=&width=542)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666105372634-53d7a00b-9719-4635-a691-058ce01fab95.png#clientId=udcba4a12-6bab-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=56&id=u4d2109fa&margin=%5Bobject%20Object%5D&name=image.png&originHeight=70&originWidth=1418&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5910&status=done&style=none&taskId=uc01ad6e9-021b-467a-a178-bfcda68e86c&title=&width=1134.4)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666105402119-1a6e063f-15eb-42ff-afbb-1ba57e9431fc.png#clientId=udcba4a12-6bab-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=171&id=u4b213649&margin=%5Bobject%20Object%5D&name=image.png&originHeight=214&originWidth=1129&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11601&status=done&style=none&taskId=u18451102-270e-49d2-baad-f9f728c61bc&title=&width=903.2)
## 4.5 删除学生
### ① 前端
与4.2一致
### ② 后端
Service
```java
public Boolean delete(Integer id) {
    //宿舍可住人数+1
    Student student = studentMapper.selectById(id);
    Dormitory dormitory = dormitoryMapper.selectById(student.getDormitoryId());
    if(dormitory.getType() > dormitory.getAvailable()) {
        if(dormitoryMapper.addAvailable(student.getDormitoryId()) != 1) {
            return false;
        }
    }

    //删除学生
    if(studentMapper.deleteById(id) != 1)
        return false;

    return true;
}
```
先根据Student的宿舍id查出宿舍，再删除学生。
否则学生删除了就找不到了。

Controller
```java
@DeleteMapping("/deleteById/{id}")
public ResultVo deleteById(@PathVariable("id") Integer id) {
    if(studentService.delete(id))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```

### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666181668960-8585825c-c883-4a88-937b-b94e29a879f4.png#averageHue=%23b3b3b3&clientId=uc57c5ab0-2f53-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=160&id=u6fa77d29&margin=%5Bobject%20Object%5D&name=image.png&originHeight=250&originWidth=847&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11763&status=done&style=none&taskId=u631e3822-23f2-4cc2-be20-710c4310af0&title=&width=543.6000366210938)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666181659347-27692095-88b9-41b3-abb5-2189c94ad87b.png#averageHue=%23c4c4c4&clientId=uc57c5ab0-2f53-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=148&id=u618094e3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=218&originWidth=644&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7169&status=done&style=none&taskId=uc40a4bf0-ecf2-4612-b559-d6f9517841c&title=&width=436.20001220703125)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666181649259-e0ee7755-7d65-4b9d-ba84-684086da1e5c.png#averageHue=%2329353b&clientId=uc57c5ab0-2f53-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=165&id=ub1ef4e06&margin=%5Bobject%20Object%5D&name=image.png&originHeight=206&originWidth=1140&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13606&status=done&style=none&taskId=u76605904-ece0-4014-8ce3-842d6c9f2c3&title=&width=912)
删除后
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666181694736-34622a28-1325-4204-941d-6bf93a544ece.png#averageHue=%2329363c&clientId=uc57c5ab0-2f53-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=151&id=u3167fe64&margin=%5Bobject%20Object%5D&name=image.png&originHeight=189&originWidth=1106&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13557&status=done&style=none&taskId=ud86a8905-438c-4039-8c00-56e5f31d7fa&title=&width=884.8)


# 5. 宿舍楼模块
## 5.1 添加宿舍楼
### ① 前端
```vue
<template>
    <div style="margin-top: 60px;margin-left:330px;width: 300px;height: 500px;border: 0px solid red;" >
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="名称" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>
            <el-form-item label="介绍" prop="introduction">
                <el-input v-model="ruleForm.introduction"></el-input>
            </el-form-item>
            <el-form-item label="管理员" prop="adminId">
                <el-select v-model="ruleForm.adminId" placeholder="请选择管理员">
                    <el-option v-for="item in dormitoryAdminList" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即创建</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                category:null,
                ruleForm: {
                    name: '',
                    introduction: '',
                    adminId: ''
                },
                dormitoryAdminList: '',
                rules: {
                    name: [
                        { required: true, message: '请输入名称', trigger: 'blur' }
                    ],
                    introduction: [
                        { required: true, message: '请输入介绍', trigger: 'blur' }
                    ],
                    adminId: [
                        { required: true, message: '请选择管理员', trigger: 'change' }
                    ]
                }
            };
        },
        methods: {
            submitForm(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios.post('http://localhost:8081/building/save',this.ruleForm).then((resp) => {
                            console.log(resp.data);
                            if(resp.data.code === 0){
                                console.log(resp.data);
                                this.$alert(this.ruleForm.name + '添加成功', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        this.$router.push('/buildingManager')
                                    }
                                });
                            }
                        })
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        },
        created() {
            axios.get('http://localhost:8081/dormitoryAdmin/list').then((resp) => {
                this.dormitoryAdminList = resp.data.data
            })
        }
    }
</script>

```

### ② 后端
Service
使用IService中的方法。

Controller
dormitoryAdmin
```java
@GetMapping("/list")
public ResultVo list() {
    return ResultVOUtil.success(dormitoryAdminService.list());
}
```
building
```java
@PostMapping("/save")
public ResultVo save(@RequestBody Building building) {
    if(buildingService.save(building))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666615079269-8e602e0a-51d1-4aff-92a1-85f359512345.png#averageHue=%23fefefe&clientId=u7cc905ae-c9e2-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=304&id=u2dd2c661&margin=%5Bobject%20Object%5D&name=image.png&originHeight=439&originWidth=461&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9863&status=done&style=none&taskId=u0a49e452-d2a4-4a00-91cb-d73e58fa7c2&title=&width=318.8000183105469)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666615141765-cf926da3-0460-42e1-a653-f72da82e8198.png#averageHue=%239a9a9a&clientId=u7cc905ae-c9e2-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=304&id=u384bd986&margin=%5Bobject%20Object%5D&name=image.png&originHeight=450&originWidth=783&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13801&status=done&style=none&taskId=uda818a37-d3d5-452c-9f30-e217338c10d&title=&width=529.3999938964844)

## 5.2 查询功能
### ① 前端
同5.1

### ② 后端
BuildingVO
```java
@Data
public class BuildingVO {
    private Integer id;

    private String name;

    private String introduction;

    private String adminName;
}
```
Service
```java
public PageVO list(Integer page, Integer size) {
    Page<Building> page1 = new Page<>(page, size);
    Page<Building> buildingPage = buildingMapper.selectPage(page1, null);

    //Building转化为BuildingVO
    List<BuildingVO> list = new ArrayList<>();
    for(Building building: buildingPage.getRecords()) {
        BuildingVO buildingVO = new BuildingVO();
        BeanUtils.copyProperties(building, buildingVO);
        buildingVO.setAdminName(dormitoryAdminMapper.selectById(building.getAdminId()).getName());
        list.add(buildingVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setTotal(buildingPage.getTotal());
    pageVO.setData(list);
    return pageVO;
}
```

Controller
```java
@GetMapping("/list/{page}/{size}")
public ResultVo list(@PathVariable("page") Integer page, @PathVariable("size") Integer size) {
    return ResultVOUtil.success(buildingService.list(page, size));
}
```

### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666620631703-0b847f64-8a6a-484e-bdc8-33e3965140f2.png#averageHue=%23fbfafa&clientId=u7cc905ae-c9e2-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=403&id=u98933a34&margin=%5Bobject%20Object%5D&name=image.png&originHeight=504&originWidth=1538&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33356&status=done&style=none&taskId=u9b377716-8a89-402a-896f-b6a5d60ccc7&title=&width=1230.4)

## 5.3 搜索
### ① 前端
同5.1

### ② 后端
Service
```java
public PageVO search(SearchForm searchForm) {
    Page<Building> page1 = new Page<>(searchForm.getPage(), searchForm.getSize());
    Page<Building> buildingPage;
    if(searchForm.getValue().equals(""))
        buildingPage = buildingMapper.selectPage(page1, null);
    else {
        QueryWrapper<Building> queryWrapper = new QueryWrapper<>();
        queryWrapper.like(searchForm.getKey(), searchForm.getValue());
        buildingPage = buildingMapper.selectPage(page1, queryWrapper);
    }

    //Building转化为BuildingVO
    List<BuildingVO> list = new ArrayList<>();
    for(Building building: buildingPage.getRecords()) {
        BuildingVO buildingVO = new BuildingVO();
        BeanUtils.copyProperties(building, buildingVO);
        buildingVO.setAdminName(dormitoryAdminMapper.selectById(building.getAdminId()).getName());
        list.add(buildingVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setTotal(buildingPage.getTotal());
    pageVO.setData(list);
    return pageVO;
}
```

Controller
```java
@GetMapping("/search")
public ResultVo search(SearchForm searchForm) {
    return ResultVOUtil.success(buildingService.search(searchForm));
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666622866634-49c2166d-c72f-47d3-8adc-2b778efca77f.png#averageHue=%23fcfbfb&clientId=u7cc905ae-c9e2-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=448&id=ud5df5493&margin=%5Bobject%20Object%5D&name=image.png&originHeight=560&originWidth=1548&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30853&status=done&style=none&taskId=udc948a86-c86a-4c5d-8cbb-91b6ae4be92&title=&width=1238.4)

## 5.4 修改宿舍楼
### ① 前端
```vue
<template>
    <div style="margin-top: 60px;margin-left:330px;width: 300px;height: 500px;border: 0px solid red;" >
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="ID">
                <el-input v-model="ruleForm.id" readonly></el-input>
            </el-form-item>
            <el-form-item label="名称" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>
            <el-form-item label="介绍" prop="introduction">
                <el-input v-model="ruleForm.introduction"></el-input>
            </el-form-item>
            <el-form-item label="管理员" prop="adminId">
                <el-select v-model="ruleForm.adminId" placeholder="请选择管理员">
                    <el-option v-for="item in dormitoryAdminList" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即修改</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                category:null,
                ruleForm: {
                    name: '',
                    introduction: '',
                    adminId: ''
                },
                dormitoryAdminList: '',
                rules: {
                    name: [
                        { required: true, message: '请输入名称', trigger: 'blur' }
                    ],
                    introduction: [
                        { required: true, message: '请输入介绍', trigger: 'blur' }
                    ],
                    adminId: [
                        { required: true, message: '请选择管理员', trigger: 'change' }
                    ]
                }
            };
        },
        methods: {
            submitForm(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios.put('http://localhost:8081/building/update',this.ruleForm).then((resp) => {
                            if(resp.data.code === 0){
                                this.$alert(this.ruleForm.name+'修改成功', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        this.$router.push('/buildingManager')
                                    }
                                });
                            }
                        })
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        },
        created() {
            axios.get('http://localhost:8081/dormitoryAdmin/list').then((resp) => {
                this.dormitoryAdminList = resp.data.data
            })
            axios.get('http://localhost:8081/building/findById/' + this.$route.query.id).then((resp) => {
                this.ruleForm = resp.data.data
            })
        }
    }
</script>

```

### ② 后端
Service
使用IService

Controller
```java
@GetMapping("/findById/{id}")
public ResultVo findById(@PathVariable("id") Integer id) {
    return ResultVOUtil.success(buildingService.getById(id));
}

@PutMapping("/update")
public ResultVo update(@RequestBody Building building) {
    if(buildingService.updateById(building))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```

### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666622597462-5bd19e01-df80-4773-87e2-abc0ead47002.png#averageHue=%23fefefe&clientId=u7cc905ae-c9e2-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=348&id=u089d2ad6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=464&originWidth=516&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11507&status=done&style=none&taskId=u92aa1fed-bfa9-45bd-a8c6-5a4082570ef&title=&width=386.8000183105469)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666622588316-ce1553bb-b38f-49cf-9498-253f24716566.png#averageHue=%239c9c9c&clientId=u7cc905ae-c9e2-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=313&id=u102bfb70&margin=%5Bobject%20Object%5D&name=image.png&originHeight=481&originWidth=692&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12981&status=done&style=none&taskId=u62cdd36d-84a4-4447-9e9b-b008264e22a&title=&width=450.6000061035156)

## 5.5 删除宿舍楼
### ① 前端
同5.1

### ② 后端
Mapper
```xml
<select id="findAvailableDormitoryId" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  select id from dormitory.dormitory
  where available > 0 limit 0,1
</select>
```
Service
```java
public Boolean deleteById(Integer id) {
    //找到宿舍楼的所有宿舍
    QueryWrapper<Dormitory> dormitoryQueryWrapper = new QueryWrapper<>();
    dormitoryQueryWrapper.eq("building_id", id);
    List<Dormitory> dormitoryList = dormitoryMapper.selectList(dormitoryQueryWrapper);

    for(Dormitory dormitory: dormitoryList) {
        //找到宿舍中的所有学生
        QueryWrapper<Student> studentQueryWrapper = new QueryWrapper<>();
        studentQueryWrapper.eq("dormitory_id", dormitory.getId());
        List<Student> studentList = studentMapper.selectList(studentQueryWrapper);


        for(Student student: studentList) {
            //未住满的宿舍id
            Integer availableDormitoryId = dormitoryMapper.findAvailableDormitoryId();
            student.setDormitoryId(availableDormitoryId);
            try{
                //给每个学生换宿舍
                studentMapper.updateById(student);
                //宿舍可住人数 -1
                dormitoryMapper.subAvailable(availableDormitoryId);
            } catch (Exception e) {
                return false;
            }
        }
        //删除宿舍
        if(dormitoryMapper.deleteById(dormitory) != 1)
            return false;
    }

    //删除宿舍楼
    if(buildingMapper.deleteById(id) != 1)
        return false;

    return true;
}
```

Controller
```java
@DeleteMapping("/deleteById/{id}")
public ResultVo deleteById(@PathVariable("id") Integer id) {
    if(buildingService.deleteById(id))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```

### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666704618836-6de31f71-5b9b-4e29-a81c-aa089ab810f2.png#averageHue=%2329373d&clientId=u185d4364-9d28-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=228&id=u6a3963c0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=362&originWidth=779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24391&status=done&style=none&taskId=ub28c7fc4-aceb-4998-a15d-d08c630fa0b&title=&width=491.20001220703125)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666704653061-6b842b52-8c55-4751-9f50-1ec6d4670f81.png#averageHue=%232c3a41&clientId=u185d4364-9d28-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=333&id=u64342727&margin=%5Bobject%20Object%5D&name=image.png&originHeight=726&originWidth=1306&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78422&status=done&style=none&taskId=u8dc12576-8463-49a6-bf48-6cffc7e5bc8&title=&width=599)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666704673507-ff6b5753-6975-4fa0-96de-138121bf06eb.png#averageHue=%23faf9f9&clientId=u185d4364-9d28-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=171&id=u2337e35d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=409&originWidth=1525&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24376&status=done&style=none&taskId=ua1e5c90c-c225-4c25-960c-01f8b8da633&title=&width=638)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666704685296-74faad9a-5904-4a9b-87dd-30afed4c0543.png#averageHue=%23a1a1a1&clientId=u185d4364-9d28-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=204&id=u1fba8e82&margin=%5Bobject%20Object%5D&name=image.png&originHeight=362&originWidth=862&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19653&status=done&style=none&taskId=u0bdf4c9b-28c4-4d4b-b759-74cf3c31252&title=&width=485.60003662109375)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666704690960-8e4c19ad-03c4-49bc-af02-74d95d0111a1.png#averageHue=%23a3a3a3&clientId=u185d4364-9d28-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=164&id=udc861164&margin=%5Bobject%20Object%5D&name=image.png&originHeight=323&originWidth=798&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15135&status=done&style=none&taskId=ue9db94c8-cbde-4567-ba0d-93fae807676&title=&width=405.4000244140625)
删除后
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666704729511-59304bf4-3d4a-4d41-8fdf-a97a835a447d.png#averageHue=%2329363d&clientId=u185d4364-9d28-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=212&id=u5a9afe08&margin=%5Bobject%20Object%5D&name=image.png&originHeight=321&originWidth=806&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20674&status=done&style=none&taskId=u992c69a7-34fa-4288-a490-2d2bea57f97&title=&width=531.7999877929688)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666704864760-637ccb5e-558f-435e-8ccf-384ca913a419.png#averageHue=%232a363d&clientId=u185d4364-9d28-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=323&id=ua80fc5dc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=753&originWidth=1124&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60298&status=done&style=none&taskId=u22afeca3-43ed-4d9d-9b27-da14d3f3f4c&title=&width=482)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666704898324-39e79a9c-85e2-4a39-85bf-035ec19dfae1.png#averageHue=%232c3a41&clientId=u185d4364-9d28-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=287&id=u8565f4b5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=737&originWidth=1337&originalType=binary&ratio=1&rotation=0&showTitle=false&size=84898&status=done&style=none&taskId=ub0339895-08bc-4730-9f81-0c1cb500de8&title=&width=520)

# 6. 宿舍模块
## 6.1 添加宿舍
### ① 前端
```vue
<template>
    <div style="margin-top: 60px;margin-left:330px;width: 300px;height: 500px;border: 0px solid red;" >
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="楼宇" prop="buildingId">
                <el-select v-model="ruleForm.buildingId" placeholder="请选择楼宇">
                    <el-option v-for="item in buildingList" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="名称" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>
            <el-form-item label="几人间" prop="type">
                <el-select v-model="ruleForm.type" placeholder="请选择几人间">
                    <el-option label="4人间" value="4"></el-option>
                    <el-option label="6人间" value="6"></el-option>
                    <el-option label="8人间" value="8"></el-option>
                    <el-option label="10人间" value="10"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="联系电话" prop="telephone">
                <el-input v-model="ruleForm.telephone"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即创建</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                category:null,
                ruleForm: {
                    buildingId: '',
                    name: '',
                    type: '',
                    telephone: ''
                },
                buildingList: '',
                rules: {
                    buildingId: [
                        { required: true, message: '请选择楼宇', trigger: 'change' }
                    ],
                    name: [
                        { required: true, message: '请输入名称', trigger: 'blur' }
                    ],
                    telephone: [
                        { required: true, message: '请输入联系电话', trigger: 'blur' }
                    ],
                    type: [
                        { required: true, message: '请选择几人间', trigger: 'change' }
                    ]
                }
            };
        },
        methods: {
            submitForm(formName) {
                const _this = this
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios.post('http://localhost:8081/dormitory/save',_this.ruleForm).then(function (resp) {
                            if(resp.data.code === 0){
                                _this.$alert(_this.ruleForm.name+'添加成功', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        _this.$router.push('/dormitoryManager')
                                    }
                                });
                            }
                        })
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/building/list').then(function (resp) {
                _this.buildingList = resp.data.data
            })
        }
    }
</script>

```

### ② 后端
Service
IService

Controller
```java
@PostMapping("/save")
public ResultVo save(@RequestBody Dormitory dormitory) {
    dormitory.setAvailable(dormitory.getType());
    if(dormitoryService.save(dormitory))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```
### ③ 结果
## 6.2 查询功能
### ① 前端
```vue
<template>
    <div style="margin-top: 60px;margin-left:80px;border: 0px solid red;" >
        <el-form style="margin-left: -40px" :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="字段：" prop="key">
                <el-select v-model="ruleForm.key" style="width: 160px;float: left" placeholder="请选择字段">
                    <el-option label="名称" value="name"></el-option>
                    <el-option label="电话" value="telephone"></el-option>
                </el-select>
            </el-form-item>
            <div style="border: 0px solid red;width: 400px;height: 60px;position: relative;top: -64px;left: 270px">
                <el-form-item label="值：">
                    <el-input v-model="ruleForm.value" placeholder="请输入关键字" style="width: 160px;"></el-input>
                    <el-button type="primary" icon="el-icon-search" style="position: relative;left: 10px;" @click="submitForm('ruleForm')">搜索</el-button>
                </el-form-item>
            </div>
        </el-form>

        <el-table
                :data="tableData"
                border
                stripe
                style="width: 1161px;position: relative;top:-30px">
            <el-table-column
                    fixed
                    prop="id"
                    label="ID"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="buildingName"
                    label="楼宇"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="name"
                    label="名称"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="type"
                    label="几人间"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="available"
                    label="空余床位"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="telephone"
                    label="电话"
                    width="160">
            </el-table-column>
            <el-table-column label="操作" width="200">
                <template slot-scope="scope">
                    <el-button
                            size="mini"
                            @click="edit(scope.row)">编辑</el-button>
                    <el-button
                            size="mini"
                            type="danger"
                            @click="del(scope.row)">删除</el-button>
                </template>
            </el-table-column>
        </el-table>
        <el-pagination style="margin-top: 20px;float: right"
                       background
                       layout="prev, pager, next"
                       :page-size="pageSize"
                       :total="total"
                       :current-page.sync="currentPage"
                       @current-change="page">
        </el-pagination>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                tableData: null,
                currentPage: 1,
                pageSize: 5,
                total: null,
                key: '',
                value: '',
                ruleForm: {
                    key: '',
                    value: '',
                    page: '',
                    size: 5
                },
                rules: {
                    key: [
                        { required: true, message: '请选择字段', trigger: 'change' }
                    ]
                }
            }
        },
        methods:{
            submitForm(formName) {
                const _this = this
                //让翻页复原
                _this.currentPage=1
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        const _this = this
                        _this.ruleForm.page = _this.currentPage
                        axios.get('http://localhost:8081/dormitory/search',{params:_this.ruleForm}).then(function (resp) {
                            _this.tableData = resp.data.data.data
                            _this.total = resp.data.data.total
                        })
                    }
                });

            },
            page(currentPage){
                const _this = this
                if(_this.ruleForm.value == ''){
                    axios.get('http://localhost:8081/dormitory/list/'+currentPage+'/'+_this.pageSize).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                } else {
                    _this.ruleForm.page = _this.currentPage
                    axios.get('http://localhost:8081/dormitory/search',{params:_this.ruleForm}).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                }

            },
            edit(row){
                this.$router.push('/dormitoryUpdate?id='+row.id)
            },
            del(row) {
                const _this = this
                this.$confirm('确认删除【'+row.name+'】吗？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    axios.delete('http://localhost:8081/dormitory/deleteById/'+row.id).then(function (resp) {
                        if(resp.data.code==0){
                            _this.$alert('【'+row.name+'】已删除', '', {
                                confirmButtonText: '确定',
                                callback: action => {
                                    location.reload()
                                }
                            });
                        }
                    });
                });
            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/dormitory/list/1/'+_this.pageSize).then(function (resp) {
                _this.tableData = resp.data.data.data
                _this.total = resp.data.data.total
            })
        }
    }
</script>
```

### ② 后端
DormitoryVO
```java
@Data
public class DormitoryVO {
    private Integer id;
    private String buildingName;
    private String name;
    private Integer type;
    private Integer available;
    private String telephone;
}
```
Service
```java
public PageVO list(Integer page, Integer size) {
    Page<Dormitory> dormitoryPage = new Page<>(page, size);
    Page<Dormitory> resultPage = dormitoryMapper.selectPage(dormitoryPage, null);
    //转换成DormitoryVO
    List<DormitoryVO> dormitoryVOList = new ArrayList<>();
    for(Dormitory dormitory: resultPage.getRecords()) {
        DormitoryVO dormitoryVO = new DormitoryVO();
        BeanUtils.copyProperties(dormitory, dormitoryVO);
        dormitoryVO.setBuildingName(buildingMapper.selectById(dormitory.getBuildingId()).getName());
        dormitoryVOList.add(dormitoryVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setData(dormitoryVOList);
    pageVO.setTotal(resultPage.getTotal());
    return pageVO;
}
```

Controller
```java
@GetMapping("/list/{page}/{size}")
public ResultVo list(@PathVariable("page")Integer page, @PathVariable("size")Integer size) {
    return ResultVOUtil.success(dormitoryService.list(page, size));
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666748470303-c2c296de-40e0-4f28-9d58-3e1ce696052e.png#averageHue=%23fdfcfc&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=551&id=u78ed1db2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=689&originWidth=1596&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46101&status=done&style=none&taskId=uf6e9c467-abc3-4287-bc49-3557c7b57a1&title=&width=1276.8)
## 6.3 搜索功能
### ① 前端
```vue
同6.2
```

### ② 后端
Service
```java
 public PageVO search(SearchForm searchForm) {
    Page<Dormitory> dormitoryPage = new Page<>(searchForm.getPage(), searchForm.getSize());
    Page<Dormitory> resultPage;
    if(searchForm.getValue().equals(""))
        resultPage = dormitoryMapper.selectPage(dormitoryPage, null);
    else {
        QueryWrapper<Dormitory> queryWrapper = new QueryWrapper<>();
        queryWrapper.like(searchForm.getKey(), searchForm.getValue());
        resultPage = dormitoryMapper.selectPage(dormitoryPage, queryWrapper);
    }

    //Building转化为BuildingVO
    List<DormitoryVO> dormitoryVOList = new ArrayList<>();
    for(Dormitory dormitory: resultPage.getRecords()) {
        DormitoryVO dormitoryVO = new DormitoryVO();
        BeanUtils.copyProperties(dormitory, dormitoryVO);
        dormitoryVO.setBuildingName(buildingMapper.selectById(dormitory.getBuildingId()).getName());
        dormitoryVOList.add(dormitoryVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setData(dormitoryVOList);
    pageVO.setTotal(resultPage.getTotal());
    return pageVO;
}
```

Controller
```java
@GetMapping("/search")
public ResultVo search(SearchForm searchForm) {
    return ResultVOUtil.success(dormitoryService.search(searchForm));
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666748461763-0c4bc8d3-458e-4a0d-b95f-c912b117cd22.png#averageHue=%23fefdfd&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=443&id=uf056cff6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=554&originWidth=1615&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34351&status=done&style=none&taskId=ueb8b1d15-0bef-4b44-b352-e9d66e5cb72&title=&width=1292)

## 6.4 修改功能
### ① 前端
```vue
<template>
    <div style="margin-top: 60px;margin-left:330px;width: 300px;height: 500px;border: 0px solid red;" >
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="ID">
                <el-input v-model="ruleForm.id"></el-input>
            </el-form-item>
            <el-form-item label="宿舍楼" prop="buildingId">
                <el-select v-model="ruleForm.buildingId" placeholder="请选择宿舍楼">
                    <el-option v-for="item in buildingList" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="名称" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>
            <el-form-item label="几人间" prop="type">
                <el-select v-model="ruleForm.type" placeholder="请选择几人间">
                    <el-option label="4人间" value="4"></el-option>
                    <el-option label="6人间" value="6"></el-option>
                    <el-option label="8人间" value="8"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="联系电话" prop="telephone">
                <el-input v-model="ruleForm.telephone"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即修改</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                category:null,
                buildingList: '',
                ruleForm: {
                    id: '',
                    buildingId: '',
                    name: '',
                    type: '',
                    telephone: ''
                },
                rules: {
                    buildingId: [
                        { required: true, message: '请选择楼宇', trigger: 'change' }
                    ],
                    name: [
                        { required: true, message: '请输入名称', trigger: 'blur' }
                    ],
                    telephone: [
                        { required: true, message: '请输入联系电话', trigger: 'blur' }
                    ],
                    type: [
                        { required: true, message: '请选择几人间', trigger: 'change' }
                    ]
                }
            };
        },
        methods: {
            submitForm(formName) {
                const _this = this
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios.put('http://localhost:8081/dormitory/update',_this.ruleForm).then(function (resp) {
                            if(resp.data.code == 0){
                                _this.$alert(_this.ruleForm.name+'修改成功', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        _this.$router.push('/dormitoryManager')
                                    }
                                });
                            }
                        })
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/dormitory/findById/'+_this.$route.query.id).then(function (resp) {
                _this.ruleForm = resp.data.data
            })
            axios.get('http://localhost:8081/building/list').then((resp) => {
                this.buildingList = resp.data.data
            })
        }
    }
</script>

```

### ② 后端
Service
```java
IService
```

Controller
```java
@GetMapping("/findById/{id}")
public ResultVo findById(@PathVariable("id")Integer id) {
    return ResultVOUtil.success(dormitoryService.getById(id));
}

@PutMapping("/update")
public ResultVo update(@RequestBody Dormitory dormitory) {
    if(dormitoryService.updateById(dormitory))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750219384-23596640-132b-4d18-8785-6d7607f613ff.png#averageHue=%23fefefe&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=317&id=u3d340e57&margin=%5Bobject%20Object%5D&name=image.png&originHeight=571&originWidth=507&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14141&status=done&style=none&taskId=ud0316d14-1c4e-45d9-8108-73cfa90aee0&title=&width=281.6000061035156)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750212538-a137699e-d0be-49a3-80d3-ecbba7a3c51d.png#averageHue=%23979797&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=301&id=ud8d89733&margin=%5Bobject%20Object%5D&name=image.png&originHeight=534&originWidth=768&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15649&status=done&style=none&taskId=u153e1348-4bf8-4f0e-805c-513eef22e0e&title=&width=432.4000244140625)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750247608-8c2cc9e4-b045-4e66-9100-e5b734c6744c.png#averageHue=%23f3f6f9&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=53&id=ucf5f79d1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=66&originWidth=1418&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4740&status=done&style=none&taskId=ub46d175a-6bfd-4984-81bb-83a2ed68eb6&title=&width=1134.4)

## 6.5 删除功能
### ① 前端
```vue
同6.1
```

### ② 后端
Service
```java
public Boolean deleteById(Integer id) {
    //找到宿舍中的所有学生
    QueryWrapper<Student> studentQueryWrapper = new QueryWrapper<>();
    studentQueryWrapper.eq("dormitory_id", id);
    List<Student> studentList = studentMapper.selectList(studentQueryWrapper);

    for(Student student: studentList) {
        //未住满的宿舍id
        Integer availableDormitoryId = dormitoryMapper.findAvailableDormitoryId();
        student.setDormitoryId(availableDormitoryId);
        try{
            //给每个学生换宿舍
            studentMapper.updateById(student);
            //宿舍可住人数 -1
            dormitoryMapper.subAvailable(availableDormitoryId);
        } catch (Exception e) {
            return false;
        }
    }
    //删除宿舍
    if(dormitoryMapper.deleteById(id) != 1)
        return false;
    return true;
}
```

Controller
```java
 @DeleteMapping("/deleteById/{id}")
public ResultVo deleteById(@PathVariable("id")Integer id) {
    if(dormitoryService.deleteById(id))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```
### ③ 结果
student表
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750868404-2daf5ff8-3f61-4e96-b5d1-0010d528edea.png#averageHue=%232e3e45&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=144&id=u6ba91ae0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=180&originWidth=1164&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20541&status=done&style=none&taskId=uffcff83d-9840-4d66-9bd8-0feffa474f3&title=&width=931.2)
dormitory表
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750915336-5af87876-dbb0-421e-b61d-3b8689a7fdd1.png#averageHue=%232b3940&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=133&id=u438d8d33&margin=%5Bobject%20Object%5D&name=image.png&originHeight=166&originWidth=1169&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10558&status=done&style=none&taskId=u2db98a6d-d857-4ea2-97cd-7cd2221bdec&title=&width=935.2)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750957421-6cf25642-8380-4760-af80-bdc8a18beb84.png#averageHue=%23f4f6f9&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=57&id=ue528e286&margin=%5Bobject%20Object%5D&name=image.png&originHeight=71&originWidth=1478&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5434&status=done&style=none&taskId=ub378ab64-1f85-49b0-b62b-0bae8ac883d&title=&width=1182.4)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750966933-17141aea-4227-4031-b99a-578ef52101ca.png#averageHue=%23a3a3a3&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=252&id=u178f2ca5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=357&originWidth=852&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23769&status=done&style=none&taskId=ua3974006-a338-403b-9e12-aefd3df0c62&title=&width=600.6000366210938)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750976924-70424204-c9e3-45ec-a0df-aa469d1e6452.png#averageHue=%239a9a99&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=263&id=u5c20a39d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=388&originWidth=922&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21615&status=done&style=none&taskId=uc73e07c3-5b0d-4a78-ac30-0564be8e590&title=&width=624.6000366210938)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666750992387-29e62777-cdb0-460f-baae-8d234d9e39ab.png#averageHue=%232b383f&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=180&id=u72ab979b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=225&originWidth=1097&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13399&status=done&style=none&taskId=u5f0e8780-a375-4725-bf58-b94aeb8d326&title=&width=877.6)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666751004067-9b3b3e4e-4466-4b40-afbc-e5833ed19a98.png#averageHue=%232d3d44&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=162&id=ub615d845&margin=%5Bobject%20Object%5D&name=image.png&originHeight=202&originWidth=1343&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26499&status=done&style=none&taskId=ubed63eb0-2341-4414-8faf-3659ae204ca&title=&width=1074.4)


# 7. 迁出
### ① 前端
MoveoutRegister
```vue
<template>
    <div style="margin-top: 60px;margin-left:80px;border: 0px solid red;" >
        <el-form style="margin-left: -40px" :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="字段：" prop="key">
                <el-select v-model="ruleForm.key" style="width: 160px;float: left" placeholder="请选择字段">
                    <el-option label="学号" value="number"></el-option>
                    <el-option label="姓名" value="name"></el-option>
                </el-select>
            </el-form-item>
            <div style="border: 0px solid red;width: 400px;height: 60px;position: relative;top: -64px;left: 270px">
                <el-form-item label="值：">
                    <el-input v-model="ruleForm.value" placeholder="请输入关键字" style="width: 160px;"></el-input>
                    <el-button type="primary" icon="el-icon-search" style="position: relative;left: 10px;" @click="submitForm('ruleForm')">搜索</el-button>
                </el-form-item>
            </div>
        </el-form>

        <el-table
                :data="tableData"
                border
                stripe
                style="width: 1190px;position: relative;top:-30px">
            <el-table-column
                    fixed
                    prop="id"
                    label="ID"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="dormitoryName"
                    label="宿舍"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="number"
                    label="学号"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="name"
                    label="姓名"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="gender"
                    label="性别"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="state"
                    label="状态"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="createDate"
                    label="入住时间"
                    width="180">
            </el-table-column>
            <el-table-column label="操作" width="230">
                <template slot-scope="scope">
                    <el-button
                            size="mini"
                            type="danger"
                            @click="moveout(scope.row)">迁出</el-button>
                </template>
            </el-table-column>
        </el-table>
        <el-pagination style="margin-top: 20px;float: right"
                       background
                       layout="prev, pager, next"
                       :page-size="pageSize"
                       :total="total"
                       :current-page.sync="currentPage"
                       @current-change="page">
        </el-pagination>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                tableData: null,
                currentPage: 1,
                pageSize: 5,
                total: null,
                key: '',
                value: '',
                ruleForm: {
                    key: '',
                    value: '',
                    page: '',
                    size: 5
                },
                rules: {
                    key: [
                        { required: true, message: '请选择字段', trigger: 'change' }
                    ]
                }
            }
        },
        methods:{
            submitForm(formName) {
                const _this = this
                //让翻页复原
                _this.currentPage=1
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        const _this = this
                        _this.ruleForm.page = _this.currentPage
                        axios.get('http://localhost:8081/moveout/search',{params:_this.ruleForm}).then(function (resp) {
                            _this.tableData = resp.data.data.data
                            _this.total = resp.data.data.total
                        })
                    }
                });

            },
            page(currentPage){
                const _this = this
                if(_this.ruleForm.value == ''){
                    axios.get('http://localhost:8081/moveout/list/'+currentPage+'/'+_this.pageSize).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                } else {
                    _this.ruleForm.page = _this.currentPage
                    axios.get('http://localhost:8081/moveout/search',{params:_this.ruleForm}).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                }

            },
            moveout(row) {
                const _this = this
                this.$prompt('请输入迁出原因', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    inputPattern: /^[\s\S]*.*[^\s][\s\S]*$/,
                    inputErrorMessage: '迁出原因不能为空'
                }).then(({ value }) => {
                    this.$confirm('确认迁出【'+row.name+'】吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        axios.put('http://localhost:8081/moveout/moveout/'+row.id+"/"+value).then(function (resp) {
                            if(resp.data.code == 0){
                                _this.$alert('【'+row.name+'】已迁出', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        location.reload()
                                    }
                                });
                            }
                        });
                    });
                });
            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/moveout/list/1/'+_this.pageSize).then(function (resp) {
                _this.tableData = resp.data.data.data
                _this.total = resp.data.data.total
            })
        }
    }
</script>
```
MoveoutRecord
```vue
<template>
    <div style="margin-top: 60px;margin-left:80px;border: 0px solid red;" >
        <el-form style="margin-left: -40px" :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="字段：" prop="key">
                <el-select v-model="ruleForm.key" style="width: 160px;float: left" placeholder="请选择字段">
                    <el-option label="学生" value="studentName"></el-option>
                    <el-option label="宿舍" value="dormitoryName"></el-option>
                </el-select>
            </el-form-item>
            <div style="border: 0px solid red;width: 400px;height: 60px;position: relative;top: -64px;left: 270px">
                <el-form-item label="值：">
                    <el-input v-model="ruleForm.value" placeholder="请输入关键字" style="width: 160px;"></el-input>
                    <el-button type="primary" icon="el-icon-search" style="position: relative;left: 10px;" @click="submitForm('ruleForm')">搜索</el-button>
                </el-form-item>
            </div>
        </el-form>

        <el-table
                :data="tableData"
                border
                stripe
                style="width: 1150px;position: relative;top:-30px">
            <el-table-column
                    fixed
                    prop="id"
                    label="ID"
                    width="230">
            </el-table-column>
            <el-table-column
                    prop="studentName"
                    label="学生"
                    width="230">
            </el-table-column>
            <el-table-column
                    prop="dormitoryName"
                    label="宿舍"
                    width="230">
            </el-table-column>
            <el-table-column
                    prop="reason"
                    label="迁出原因"
                    width="230">
            </el-table-column>
            <el-table-column
                    prop="createDate"
                    label="迁出日期"
                    width="230">
            </el-table-column>
        </el-table>
        <el-pagination style="margin-top: 20px;float: right"
                       background
                       layout="prev, pager, next"
                       :page-size="pageSize"
                       :total="total"
                       :current-page.sync="currentPage"
                       @current-change="page">
        </el-pagination>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                tableData: null,
                currentPage: 1,
                pageSize: 3,
                total: null,
                key: '',
                value: '',
                ruleForm: {
                    key: '',
                    value: '',
                    page: '',
                    size: 3
                },
                rules: {
                    key: [
                        { required: true, message: '请选择字段', trigger: 'change' }
                    ]
                }
            }
        },
        methods:{
            submitForm(formName) {
                const _this = this
                //让翻页复原
                _this.currentPage=1
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        const _this = this
                        _this.ruleForm.page = _this.currentPage
                        axios.get('http://localhost:8081/moveout/moveoutSearch',{params:_this.ruleForm}).then(function (resp) {
                            _this.tableData = resp.data.data.data
                            _this.total = resp.data.data.total
                        })
                    }
                });

            },
            page(currentPage){
                const _this = this
                if(_this.ruleForm.value == ''){
                    axios.get('http://localhost:8081/moveout/moveoutList/'+currentPage+'/'+_this.pageSize).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                } else {
                    _this.ruleForm.page = _this.currentPage
                    axios.get('http://localhost:8081/moveout/moveoutSearch',{params:_this.ruleForm}).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                }

            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/moveout/moveoutList/1/'+_this.pageSize).then(function (resp) {
                _this.tableData = resp.data.data.data
                _this.total = resp.data.data.total
            })
        }
    }
</script>
```
### ② 后端
Service
```java
@Override
public PageVO list(Integer page, Integer size) {
    Page<Student> studentPage = new Page<>(page, size);
    QueryWrapper<Student> studentQueryWrapper = new QueryWrapper<>();
    studentQueryWrapper.eq("state", "入住");
    Page<Student> resultPage = studentMapper.selectPage(studentPage, studentQueryWrapper);

    //转换成VO
    List<Student> studentList = resultPage.getRecords();
    List<StudentVO> studentVOList = new ArrayList<>();
    for(Student student : studentList) {
        StudentVO studentVO = new StudentVO();
        //复制相同属性
        BeanUtils.copyProperties(student, studentVO);
        studentVO.setDormitoryName(dormitoryMapper.selectById(student.getDormitoryId()).getName());
        studentVOList.add(studentVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setData(studentVOList);
    pageVO.setTotal(resultPage.getTotal());
    return pageVO;
}

@Override
public PageVO search(SearchForm searchForm) {
    Page<Student> studentPage = new Page<>(searchForm.getPage(), searchForm.getSize());
    Page<Student> resultPage;
    QueryWrapper<Student> studentQueryWrapper = new QueryWrapper<>();
    studentQueryWrapper.eq("state", "入住");
    if(searchForm.getValue().equals("")) {  //搜索框为空
        resultPage = studentMapper.selectPage(studentPage, studentQueryWrapper);
    } else {
        studentQueryWrapper.like(searchForm.getKey(), searchForm.getValue());
        resultPage = studentMapper.selectPage(studentPage, studentQueryWrapper);
    }

    //转换成VO
    List<Student> studentList = resultPage.getRecords();
    List<StudentVO> studentVOList = new ArrayList<>();
    for(Student student : studentList) {
        StudentVO studentVO = new StudentVO();
        //复制相同属性
        BeanUtils.copyProperties(student, studentVO);
        studentVO.setDormitoryName(dormitoryMapper.selectById(student.getDormitoryId()).getName());
        studentVOList.add(studentVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setData(studentVOList);
    pageVO.setTotal(resultPage.getTotal());
    return pageVO;
}

@Override
public Boolean moveout(Integer id, String value) {
    //添加迁入记录
    Moveout moveout = new Moveout();
    moveout.setStudentId(id);
    moveout.setReason(value);
    moveout.setCreateDate(CommonUtil.createDate());
    Student student = studentMapper.selectById(id);
    moveout.setDormitoryId(student.getDormitoryId());
    if(moveoutMapper.insert(moveout) != 1)
        return false;

    //学生状态 --> 迁出
    student.setState("迁出");
    if(studentMapper.updateById(student) != 1)
        return false;

    //宿舍可住人数+1
    try{
        dormitoryMapper.addAvailable(student.getDormitoryId());
    } catch (Exception e) {
        return false;
    }

    return true;
}

@Override
public PageVO moveoutList(Integer page, Integer size) {
    Page<Moveout> moveoutPage = new Page<>(page, size);
    Page<Moveout> resultPage = moveoutMapper.selectPage(moveoutPage, null);

    List<MoveoutVO> moveoutVOList = new ArrayList<>();
    for (Moveout moveout : resultPage.getRecords()) {
        MoveoutVO moveoutVO = new MoveoutVO();
        BeanUtils.copyProperties(moveout, moveoutVO);
        moveoutVO.setStudentName(studentMapper.selectById(moveout.getStudentId()).getName());
        moveoutVO.setDormitoryName(dormitoryMapper.selectById(moveout.getDormitoryId()).getName());
        moveoutVOList.add(moveoutVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setTotal(resultPage.getTotal());
    pageVO.setData(moveoutVOList);

    return pageVO;
}

@Override
public PageVO moveoutSearch(SearchForm searchForm) {
    Page<Moveout> moveoutPage = new Page<>(searchForm.getPage(), searchForm.getSize());
    Page<Moveout> resultPage = null;
    if(searchForm.getValue().equals("")) {
        resultPage = moveoutMapper.selectPage(moveoutPage, null);
    } else {
        QueryWrapper<Moveout> moveoutQueryWrapper = new QueryWrapper<>();
        if (searchForm.getKey().equals("studentName")) {
            //模糊搜索学生名字
            QueryWrapper<Student> studentQueryWrapper = new QueryWrapper<>();
            studentQueryWrapper.like("name", searchForm.getValue());
            List<Student> studentList = studentMapper.selectList(studentQueryWrapper);

            //搜索出的学生id
            List<Integer> studentIdList = new ArrayList<>();
            for (Student student : studentList) {
                studentIdList.add(student.getId());
            }

            //student_id in studentIdList的学生
            moveoutQueryWrapper.in("student_id", studentIdList);
        } else if (searchForm.getKey().equals("dormitoryName")) {
            //模糊搜索宿舍名字
            QueryWrapper<Dormitory> dormitoryQueryWrapper = new QueryWrapper<>();
            dormitoryQueryWrapper.like("name", searchForm.getValue());
            List<Dormitory> dormitoryList = dormitoryMapper.selectList(dormitoryQueryWrapper);

            //搜索出的宿舍id
            List<Integer> dormitoryIdList = new ArrayList<>();
            for (Dormitory dormitory : dormitoryList) {
                dormitoryIdList.add(dormitory.getId());
            }

            //in studentIdList的宿舍
            moveoutQueryWrapper.in("dormitory_id", dormitoryIdList);
        }
        resultPage = moveoutMapper.selectPage(moveoutPage, moveoutQueryWrapper);
    }
    List<MoveoutVO> moveoutVOList = new ArrayList<>();
    for (Moveout moveout : resultPage.getRecords()) {
        MoveoutVO moveoutVO = new MoveoutVO();
        BeanUtils.copyProperties(moveout, moveoutVO);
        moveoutVO.setStudentName(studentMapper.selectById(moveout.getStudentId()).getName());
        moveoutVO.setDormitoryName(dormitoryMapper.selectById(moveout.getDormitoryId()).getName());
        moveoutVOList.add(moveoutVO);
    }

    PageVO pageVO = new PageVO();
    pageVO.setTotal(resultPage.getTotal());
    pageVO.setData(moveoutVOList);

    return pageVO;
}
```

Controller
```java
@ApiOperation("分页查询学生信息")
@GetMapping("/list/{page}/{size}")
public ResultVo list(@PathVariable("page") Integer page, @PathVariable("size") Integer size) {
    return ResultVOUtil.success(moveoutService.list(page, size));
}

@ApiOperation("模糊搜索迁出注册")
@GetMapping("/search")
public ResultVo search(SearchForm searchForm) {
    return ResultVOUtil.success(moveoutService.search(searchForm));
}

@ApiOperation("查询所有迁出记录")
@GetMapping("/moveoutList/{page}/{size}")
public ResultVo moveoutList(@PathVariable("page") Integer page, @PathVariable("size") Integer size) {
    return ResultVOUtil.success(moveoutService.moveoutList(page, size));
}

@ApiOperation("模糊搜索迁出记录")
@GetMapping("/moveoutSearch")
public ResultVo moveoutSearch(SearchForm searchForm) {
    return ResultVOUtil.success(moveoutService.moveoutSearch(searchForm));
}

@ApiOperation("学生迁入")
@PutMapping("/moveout/{id}/{value}")
public ResultVo moveout(@PathVariable("id")Integer id, @PathVariable("value")String value) {
    if(moveoutService.moveout(id, value))
        return ResultVOUtil.success(null);
    return ResultVOUtil.fail();
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666754011188-7f8aab42-3f23-4666-895e-b5f0a5dbbc3f.png#averageHue=%232c3b42&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=68&id=ua7cf81b5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=140&originWidth=1340&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16719&status=done&style=none&taskId=ubac73742-53e1-4646-91cb-0396987ae39&title=&width=654)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666754046032-87de7a23-d3a7-4433-a05b-cc17063278b3.png#averageHue=%23aeaeae&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=272&id=u76c5c9cc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=458&originWidth=783&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22822&status=done&style=none&taskId=u0bee1aa7-79cb-4842-970c-010a160904b&title=&width=464.4000244140625)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666754052083-964ec4c3-6ca3-4f5f-a879-3831eac30bfe.png#averageHue=%23bfbebe&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=174&id=u05bda578&margin=%5Bobject%20Object%5D&name=image.png&originHeight=259&originWidth=671&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13091&status=done&style=none&taskId=u3504a2b4-f0cc-453b-bd44-5f174b81097&title=&width=450.79998779296875)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666754057251-f0648724-c8d5-44ca-a07d-2901d61a61b2.png#averageHue=%239f9f9f&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=206&id=u96d490ac&margin=%5Bobject%20Object%5D&name=image.png&originHeight=373&originWidth=794&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20861&status=done&style=none&taskId=u633cf453-fb23-41b6-966b-b0fe16cac7f&title=&width=438.20001220703125)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666790248006-a151af23-293b-4d9b-ad81-d04bb1809d3e.png#averageHue=%23faf5f5&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=171&id=uac9139c6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=420&originWidth=1562&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23144&status=done&style=none&taskId=u6f924ed1-2869-4843-b6b0-15391dba831&title=&width=637)

# 8. 缺寝登记
### ① 前端
DormitoryAdmin
```vue
<template>
    <el-container class="home_container">
        <el-header class="home_header">
            <div class="home_title">DORMS宿舍管理系统-宿舍管理员</div>
            <div class="home_userinfoContainer">
                <el-dropdown>
                  <span class="el-dropdown-link home_userinfo">
                    {{admin.username}}<i class="el-icon-arrow-down el-icon--right home_userinfo"></i>
                  </span>
                    <el-dropdown-menu slot="dropdown">
                        <el-dropdown-item @click.native="logout">退出登录</el-dropdown-item>
                    </el-dropdown-menu>
                </el-dropdown>
            </div>
        </el-header>
        <el-container>

            <el-aside class="home_aside" width="200px">

                <el-menu router>
                    <el-menu-item index="/dormitoryAdmin/absentRegister" :class="$route.path==='/dormitoryAdmin/absentRegister'?'is-active':''">
                        <i class="el-icon-s-order"></i>
                        <span slot="title">学生缺寝登记</span>
                    </el-menu-item>

                    <el-menu-item index="/dormitoryAdmin/absentRecord">
                        <i class="el-icon-error"></i>
                        <span slot="title">学生缺寝记录</span>
                    </el-menu-item>
                </el-menu>

            </el-aside>

            <el-container>
                <el-main>
                    <el-breadcrumb separator-class="el-icon-arrow-right">
                        <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
                        <el-breadcrumb-item v-text="this.$router.currentRoute.name"></el-breadcrumb-item>
                    </el-breadcrumb>
                    <router-view></router-view>
                </el-main>
                <el-footer class="home_footer">2022 © DORMS</el-footer>
            </el-container>

        </el-container>

    </el-container>
</template>
<script>
    export default{
        methods: {
            logout(){
                let _this = this;
                this.$confirm('注销登录吗?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(function () {
                    localStorage.removeItem('access-admin')
                    _this.$router.replace({path: '/login'})
                })
            }
        },
        data(){
            return {
                admin:''
            }
        },
        created() {
            let admin = JSON.parse(window.localStorage.getItem('dormitoryAdmin'))
            this.admin = admin
            this.$store.state.admin = admin
        }
    }
</script>
<style>
    .home_container {
        height: 100%;
        position: absolute;
        top: 0px;
        left: 0px;
        width: 100%;
    }

    .home_header {
        background-color: #2B2B2B;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .home_title {
        color: #C2C2C2;
        font-size: 22px;
        display: inline;
    }

    .home_userinfo {
        color: #fff;
        cursor: pointer;
    }

    .home_userinfoContainer {
        display: inline;
        margin-right: 20px;
    }

    .home_aside {
        background-color: #FFFFFF;
    }

    .home_footer {
        background-color: #FFFFFF;
        color: #000000;
        font-size: 18px;
        line-height: 60px;
        text-align: center;
    }
</style>

```
AbsentRegister
```vue
<template>
    <div style="margin-top: 60px;margin-left:330px;width: 300px;height: 500px;border: 0px solid red;" >
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="楼宇" prop="buildingId">
                <el-select v-model="ruleForm.buildingId" placeholder="请选择楼宇" @change="buildingChange">
                    <el-option v-for="item in buildingList" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="宿舍" prop="dormitoryId">
                <el-select v-model="ruleForm.dormitoryId" placeholder="请选择宿舍" @change="dormitoryChange">
                    <el-option v-for="item in dormitoryList" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="学生" prop="studentId">
                <el-select v-model="ruleForm.studentId" placeholder="请选择学生">
                    <el-option v-for="item in studentList" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="原因" prop="reason">
                <el-input v-model="ruleForm.reason"></el-input>
            </el-form-item>
            <el-form-item label="日期" prop="createDate">
                <el-date-picker
                        style="width: 200px"
                        v-model="ruleForm.createDate"
                        type="date"
                        placeholder="选择日期">
                </el-date-picker>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即提交</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
        </el-form>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                category:null,
                ruleForm: {
                    buildingId: '',
                    dormitoryId: '',
                    studentId: '',
                    reason: '',
                    createDate: '',
                    dormitoryAdminId: ''
                },
                buildingList: '',
                dormitoryList: '',
                studentList: '',
                rules: {
                    buildingId: [
                        { required: true, message: '请选择楼宇', trigger: 'change' }
                    ],
                    dormitoryId: [
                        { required: true, message: '请选择宿舍', trigger: 'change' }
                    ],
                    studentId: [
                        { required: true, message: '请选择学生', trigger: 'change' }
                    ],
                    reason: [
                        { required: true, message: '请输入原因', trigger: 'blur' }
                    ],
                    createDate: [
                        { required: true, message: '请输入日期', trigger: 'blur' }
                    ]
                }
            };
        },
        methods: {
            buildingChange(){
                const _this = this
                axios.get('http://localhost:8081/absent/findDormitoryByBuildingId/'+_this.ruleForm.buildingId).then(function (resp) {
                    _this.dormitoryList = resp.data.data
                    _this.ruleForm.dormitoryId = ''
                    _this.ruleForm.studentId = ''
                })
            },
            dormitoryChange(){
                const _this = this
                axios.get('http://localhost:8081/absent/findStudentByDormitoryId/'+_this.ruleForm.dormitoryId).then(function (resp) {
                    _this.studentList = resp.data.data
                    _this.ruleForm.studentId = ''
                })
            },
            submitForm(formName) {
                const _this = this
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        let admin = _this.$store.state.admin
                        _this.ruleForm.dormitoryAdminId = admin.id
                        console.log(_this.ruleForm)
                        axios.post('http://localhost:8081/absent/save',_this.ruleForm).then(function (resp) {
                            if(resp.data.code == 0){
                                _this.$alert('缺寝登记成功', '', {
                                    confirmButtonText: '确定',
                                    callback: action => {
                                        _this.$router.push('/dormitoryAdmin/absentRecord')
                                    }
                                });
                            }
                        })
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/absent/buildingList').then(function (resp) {
                _this.buildingList = resp.data.data
            })
        }
    }
</script>

```
AbsentRecord
```vue
<template>
    <div style="margin-top: 60px;margin-left:80px;border: 0px solid red;" >
        <el-form style="margin-left: -40px" :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">
            <el-form-item label="字段：" prop="key">
                <el-select v-model="ruleForm.key" style="width: 160px;float: left" placeholder="请选择字段">
                    <el-option label="楼宇" value="buildingName"></el-option>
                    <el-option label="宿舍" value="dormitoryName"></el-option>
                </el-select>
            </el-form-item>
            <div style="border: 0px solid red;width: 400px;height: 60px;position: relative;top: -64px;left: 270px">
                <el-form-item label="值：">
                    <el-input v-model="ruleForm.value" placeholder="请输入关键字" style="width: 160px;"></el-input>
                    <el-button type="primary" icon="el-icon-search" style="position: relative;left: 10px;" @click="submitForm('ruleForm')">搜索</el-button>
                </el-form-item>
            </div>
        </el-form>

        <el-table
                :data="tableData"
                border
                stripe
                style="width: 1210px;position: relative;top:-30px">
            <el-table-column
                    fixed
                    prop="id"
                    label="ID"
                    width="130">
            </el-table-column>
            <el-table-column
                    prop="buildingName"
                    label="楼宇"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="dormitoryName"
                    label="宿舍"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="studentName"
                    label="学生"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="reason"
                    label="原因"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="dormitoryAdminName"
                    label="宿管"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="createDate"
                    label="日期"
                    width="180">
            </el-table-column>
        </el-table>
        <el-pagination style="margin-top: 20px;float: right"
                       background
                       layout="prev, pager, next"
                       :page-size="pageSize"
                       :total="total"
                       :current-page.sync="currentPage"
                       @current-change="page">
        </el-pagination>
    </div>

</template>

<script>
    export default {
        data() {
            return {
                tableData: null,
                currentPage: 1,
                pageSize: 3,
                total: null,
                key: '',
                value: '',
                ruleForm: {
                    key: '',
                    value: '',
                    page: '',
                    size: 3
                },
                rules: {
                    key: [
                        { required: true, message: '请选择字段', trigger: 'change' }
                    ]
                }
            }
        },
        methods:{
            submitForm(formName) {
                const _this = this
                //让翻页复原
                _this.currentPage=1
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        const _this = this
                        _this.ruleForm.page = _this.currentPage
                        axios.get('http://localhost:8081/absent/search',{params:_this.ruleForm}).then(function (resp) {
                            _this.tableData = resp.data.data.data
                            _this.total = resp.data.data.total
                        })
                    }
                });

            },
            page(currentPage){
                const _this = this
                if(_this.ruleForm.value === ''){
                    axios.get('http://localhost:8081/absent/list/'+currentPage+'/'+_this.pageSize).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                } else {
                    _this.ruleForm.page = _this.currentPage
                    axios.get('http://localhost:8081/absent/search',{params:_this.ruleForm}).then(function (resp) {
                        _this.tableData = resp.data.data.data
                        _this.total = resp.data.data.total
                    })
                }

            }
        },
        created() {
            const _this = this
            axios.get('http://localhost:8081/absent/list/1/'+_this.pageSize).then(function (resp) {
                _this.tableData = resp.data.data.data
                _this.total = resp.data.data.total
            })
        }
    }
</script>
```

### ② 后端
Service
```java
@Override
public PageVO list(Integer page, Integer size) {
    Page<Absent> absentPage = new Page<>(page, size);
    Page<Absent> resultPage = this.absentMapper.selectPage(absentPage, null);
    List<AbsentVO> absentVOList = new ArrayList<>();
    for (Absent absent : resultPage.getRecords()) {
        AbsentVO absentVO = new AbsentVO();
        BeanUtils.copyProperties(absent, absentVO);
        absentVO.setBuildingName(this.buildingMapper.selectById(absent.getBuildingId()).getName());
        absentVO.setDormitoryName(this.dormitoryMapper.selectById(absent.getDormitoryId()).getName());
        absentVO.setStudentName(this.studentMapper.selectById(absent.getStudentId()).getName());
        absentVO.setDormitoryAdminName(this.dormitoryAdminMapper.selectById(absent.getDormitoryAdminId()).getName());
        absentVOList.add(absentVO);
    }
    PageVO pageVO = new PageVO();
    pageVO.setTotal(resultPage.getTotal());
    pageVO.setData(absentVOList);
    return pageVO;
}

@Override
public PageVO search(SearchForm searchForm) {
    Page<Absent> absentPage = new Page<>(searchForm.getPage(), searchForm.getSize());
    Page<Absent> resultPage = null;
    if(searchForm.getValue().equals("")){
        resultPage = this.absentMapper.selectPage(absentPage, null);
    } else {
        QueryWrapper<Absent> queryWrapper = new QueryWrapper<>();
        if(searchForm.getKey().equals("buildingName")){
            QueryWrapper<Building> buildingQueryWrapper = new QueryWrapper<>();
            buildingQueryWrapper.like("name", searchForm.getValue());
            List<Building> buildingList = this.buildingMapper.selectList(buildingQueryWrapper);
            List<Integer> idList = new ArrayList<>();
            for (Building building : buildingList) {
                idList.add(building.getId());
            }
            queryWrapper.in("building_id", idList);
        }
        if(searchForm.getKey().equals("dormitoryName")){
            QueryWrapper<Dormitory> dormitoryQueryWrapper = new QueryWrapper<>();
            dormitoryQueryWrapper.like("name", searchForm.getValue());
            List<Dormitory> dormitoryList = this.dormitoryMapper.selectList(dormitoryQueryWrapper);
            List<Integer> idList = new ArrayList<>();
            for (Dormitory dormitory : dormitoryList) {
                idList.add(dormitory.getId());
            }
            queryWrapper.in("dormitory_id", idList);
        }
        resultPage = this.absentMapper.selectPage(absentPage, queryWrapper);
    }
    List<AbsentVO> absentVOList = new ArrayList<>();
    for (Absent absent : resultPage.getRecords()) {
        AbsentVO absentVO = new AbsentVO();
        BeanUtils.copyProperties(absent, absentVO);
        absentVO.setBuildingName(this.buildingMapper.selectById(absent.getBuildingId()).getName());
        absentVO.setDormitoryName(this.dormitoryMapper.selectById(absent.getDormitoryId()).getName());
        absentVO.setStudentName(this.studentMapper.selectById(absent.getStudentId()).getName());
        absentVO.setDormitoryAdminName(this.dormitoryAdminMapper.selectById(absent.getDormitoryAdminId()).getName());
        absentVOList.add(absentVO);
    }
    PageVO pageVO = new PageVO();
    pageVO.setTotal(resultPage.getTotal());
    pageVO.setData(absentVOList);
    return pageVO;
}
```

Controller
```java
@ApiOperation("分页查询所有")
@GetMapping("/list/{page}/{size}")
public ResultVo list(@PathVariable("page") Integer page, @PathVariable("size") Integer size){
    return ResultVOUtil.success(this.absentService.list(page, size));
}

@ApiOperation("搜索，分页")
@GetMapping("/search")
public ResultVo search(SearchForm searchForm){
    return ResultVOUtil.success(this.absentService.search(searchForm));
}
@ApiOperation("查询所有宿舍楼")
@GetMapping("/buildingList")
public ResultVo buildingList(){
    return ResultVOUtil.success(this.buildingService.list());
}

@ApiOperation("根据id查询宿舍")
@GetMapping("/findDormitoryByBuildingId/{id}")
public ResultVo findDormitoryByBuildingId(@PathVariable("id") Integer id){
    QueryWrapper<Dormitory> queryWrapper = new QueryWrapper<>();
    queryWrapper.eq("building_id", id);
    List<Dormitory> dormitoryList = this.dormitoryService.list(queryWrapper);
    return ResultVOUtil.success(dormitoryList);
}

@ApiOperation("根据id查询学生")
@GetMapping("/findStudentByDormitoryId/{id}")
public ResultVo findStudentByDormitoryId(@PathVariable("id") Integer id){
    QueryWrapper<Student> queryWrapper = new QueryWrapper<>();
    queryWrapper.eq("dormitory_id", id);
    List<Student> studentList = this.studentService.list(queryWrapper);
    return ResultVOUtil.success(studentList);
}

@ApiOperation("添加缺寝记录")
@PostMapping("/save")
public ResultVo save(@RequestBody Absent absent){
    String createDate = absent.getCreateDate();
    createDate = createDate.substring(0, 10);
    absent.setCreateDate(createDate);
    boolean save = this.absentService.save(absent);
    if(!save) return ResultVOUtil.fail();
    return ResultVOUtil.success(null);
}
```
### ③ 结果
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666790035867-8913e22f-7292-4822-8d63-1df9357ce52f.png#averageHue=%23fefefe&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=515&id=u0c43e2ca&margin=%5Bobject%20Object%5D&name=image.png&originHeight=598&originWidth=487&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15668&status=done&style=none&taskId=u9e18f953-e8b8-40bb-bca3-88045e58f88&title=&width=419.6000061035156)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666790040082-12a1ce6c-38cc-4252-8e39-504830cbba03.png#averageHue=%23a0a0a0&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=237&id=u11cd3ee7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=388&originWidth=774&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12670&status=done&style=none&taskId=u8c8d0d0c-5e0c-4f2e-8693-e8b25e95f2d&title=&width=473.20001220703125)
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1666790050189-fe15d3ba-6b8b-44e5-9512-488fa520cac2.png#averageHue=%23f8f8f8&clientId=u58c7601a-ddb3-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=199&id=u5cc5c083&margin=%5Bobject%20Object%5D&name=image.png&originHeight=249&originWidth=1575&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8107&status=done&style=none&taskId=u9b11d5c2-1988-427e-831d-9a242270ba5&title=&width=1260)




# 问题 
## 1.  mybatis-plus generator生成不了目录
将路径改为绝对路径
> lobalConfig.setOutputDir("D:\\Programme1\\Java_Code\\Project\\Dormitory\\SpringBootProject\\dormitoryms" + "/src/main/java");

## 2. idea中注解“@Data”没有起set、get作用
getter和setter提示要装Lombok插件
![image.png](https://cdn.nlark.com/yuque/0/2022/png/32540558/1665303333939-8ea87eba-ca44-4793-9eba-414dbe717989.png#averageHue=%2328373d&clientId=u7d81d083-faec-4&crop=0&crop=0&crop=1&crop=1&errorMessage=unknown%20error&from=paste&height=681&id=uae05b3e9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=851&originWidth=941&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63333&status=error&style=none&taskId=u2139805e-190e-419d-a1cc-c2d86b0df6f&title=&width=752.8)
## 3. 非resource包下的Mapper映射文件找不到
```xml
 <resources>
    <resource>
        <directory>src/main/java</directory>
        <includes>
            <include>**/*.xml</include>
        </includes>
    </resource>
</resources>
```
因为Mapper映射文件没有放在resource包下，不能找到。在pom.xml中加上该代码就能识别非resource包下的映射文件。
## 4. 提交post请求添加宿舍楼后404错误
### ① 原因
Controller中使用@Controller注解，会返回视图，但是没有写视图，只是返回数据；对于数据库的修改是成功的，但是并没有返回数据到添加宿舍楼页面，Vue页面中没有跳转。
### ② 解决方法
将@Controller注解改为@RestController注解
## 5. 8缺寝登记中dormitory_id找不到
### ① 分析
宿舍id是存在localstore中，查看后发现没有id为key的值，是后端传来的dormitory有问题。
找到登录传来的值`resultVo.setData(userForm); //设置表单数据`
明显userForm中没有id，故改变值即可。
### ② 解决
设置Data为dormitoryAdmin
`resultVo.setData(dormitoryAdmin); //设置表单数据`
```java
public ResultVo login(UserForm userForm) {
    ResultVo<DormitoryAdmin> resultVo = new ResultVo<>();

    //1.用户是否存在
    QueryWrapper<DormitoryAdmin> queryWrapper = new QueryWrapper<>();
    queryWrapper.eq("username", userForm.getUsername());
    DormitoryAdmin dormitoryAdmin = dormitoryAdminMapper.selectOne(queryWrapper);
    if(dormitoryAdmin == null) {
        resultVo.setCode(-1);
    } else {
        //2.密码是否正确
        if(dormitoryAdmin.getPassword().equals(userForm.getPassword())) {
            resultVo.setCode(0);
            resultVo.setData(dormitoryAdmin); //设置表单数据
        } else {
            resultVo.setCode(-2);
        }
    }

    return resultVo;
}
```

## 6
